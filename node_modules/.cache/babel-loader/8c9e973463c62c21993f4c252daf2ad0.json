{"ast":null,"code":"/*\n * File: iframeResizer.contentWindow.js\n * Desc: Include this file in any page being loaded into an iframe\n *       to force the iframe to resize to the content size.\n * Requires: iframeResizer.js on host page.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n * Contributor: Jure Mav - jure.mav@gmail.com\n * Contributor: Ian Caunce - ian@hallnet.co.uk\n */\n(function (undefined) {\n  'use strict';\n\n  if (typeof window === 'undefined') return; // don't run for server side render\n\n  var autoResize = true,\n      base = 10,\n      bodyBackground = '',\n      bodyMargin = 0,\n      bodyMarginStr = '',\n      bodyObserver = null,\n      bodyPadding = '',\n      calculateWidth = false,\n      doubleEventList = {\n    resize: 1,\n    click: 1\n  },\n      eventCancelTimer = 128,\n      firstRun = true,\n      height = 1,\n      heightCalcModeDefault = 'bodyOffset',\n      heightCalcMode = heightCalcModeDefault,\n      initLock = true,\n      initMsg = '',\n      inPageLinks = {},\n      interval = 32,\n      intervalTimer = null,\n      logging = false,\n      msgID = '[iFrameSizer]',\n      //Must match host page msg ID\n  msgIdLen = msgID.length,\n      myID = '',\n      observer = null,\n      resetRequiredMethods = {\n    max: 1,\n    min: 1,\n    bodyScroll: 1,\n    documentElementScroll: 1\n  },\n      resizeFrom = 'child',\n      sendPermit = true,\n      target = window.parent,\n      targetOriginDefault = '*',\n      tolerance = 0,\n      triggerLocked = false,\n      triggerLockedTimer = null,\n      throttledTimer = 16,\n      width = 1,\n      widthCalcModeDefault = 'scroll',\n      widthCalcMode = widthCalcModeDefault,\n      win = window,\n      messageCallback = function messageCallback() {\n    warn('MessageCallback function not defined');\n  },\n      readyCallback = function readyCallback() {},\n      pageInfoCallback = function pageInfoCallback() {},\n      customCalcMethods = {\n    height: function height() {\n      warn('Custom height calculation function not defined');\n      return document.documentElement.offsetHeight;\n    },\n    width: function width() {\n      warn('Custom width calculation function not defined');\n      return document.body.scrollWidth;\n    }\n  },\n      eventHandlersByName = {},\n      passiveSupported = false,\n      onceSupported = false;\n\n  function noop() {}\n\n  try {\n    var options = Object.create({}, {\n      passive: {\n        get: function get() {\n          passiveSupported = true;\n        }\n      },\n      once: {\n        get: function get() {\n          onceSupported = true;\n        }\n      }\n    });\n    window.addEventListener('test', noop, options);\n    window.removeEventListener('test', noop, options);\n  } catch (e) {\n    /* */\n  }\n\n  function addEventListener(el, evt, func, options) {\n    /* istanbul ignore else */\n    // Not testable in phantomJS\n    if ('addEventListener' in window) {\n      el.addEventListener(evt, func, passiveSupported ? options || {} : false);\n    } else if ('attachEvent' in window) {\n      //IE\n      el.attachEvent('on' + evt, func);\n    }\n  }\n\n  function removeEventListener(el, evt, func) {\n    /* istanbul ignore else */\n    // Not testable in phantomJS\n    if ('removeEventListener' in window) {\n      el.removeEventListener(evt, func, false);\n    } else if ('detachEvent' in window) {\n      //IE\n      el.detachEvent('on' + evt, func);\n    }\n  }\n\n  function capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n  } //Based on underscore.js\n\n\n  function throttle(func) {\n    var context,\n        args,\n        result,\n        timeout = null,\n        previous = 0,\n        later = function later() {\n      previous = getNow();\n      timeout = null;\n      result = func.apply(context, args);\n\n      if (!timeout) {\n        context = args = null;\n      }\n    };\n\n    return function () {\n      var now = getNow();\n\n      if (!previous) {\n        previous = now;\n      }\n\n      var remaining = throttledTimer - (now - previous);\n      context = this;\n      args = arguments;\n\n      if (remaining <= 0 || remaining > throttledTimer) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n\n        previous = now;\n        result = func.apply(context, args);\n\n        if (!timeout) {\n          context = args = null;\n        }\n      } else if (!timeout) {\n        timeout = setTimeout(later, remaining);\n      }\n\n      return result;\n    };\n  }\n\n  var getNow = Date.now || function () {\n    /* istanbul ignore next */\n    // Not testable in PhantonJS\n    return new Date().getTime();\n  };\n\n  function formatLogMsg(msg) {\n    return msgID + '[' + myID + ']' + ' ' + msg;\n  }\n\n  function log(msg) {\n    if (logging && 'object' === typeof window.console) {\n      console.log(formatLogMsg(msg));\n    }\n  }\n\n  function warn(msg) {\n    if ('object' === typeof window.console) {\n      console.warn(formatLogMsg(msg));\n    }\n  }\n\n  function init() {\n    readDataFromParent();\n    log('Initialising iFrame (' + location.href + ')');\n    readDataFromPage();\n    setMargin();\n    setBodyStyle('background', bodyBackground);\n    setBodyStyle('padding', bodyPadding);\n    injectClearFixIntoBodyElement();\n    checkHeightMode();\n    checkWidthMode();\n    stopInfiniteResizingOfIFrame();\n    setupPublicMethods();\n    startEventListeners();\n    inPageLinks = setupInPageLinks();\n    sendSize('init', 'Init message from host page');\n    readyCallback();\n  }\n\n  function readDataFromParent() {\n    function strBool(str) {\n      return 'true' === str ? true : false;\n    }\n\n    var data = initMsg.substr(msgIdLen).split(':');\n    myID = data[0];\n    bodyMargin = undefined !== data[1] ? Number(data[1]) : bodyMargin; //For V1 compatibility\n\n    calculateWidth = undefined !== data[2] ? strBool(data[2]) : calculateWidth;\n    logging = undefined !== data[3] ? strBool(data[3]) : logging;\n    interval = undefined !== data[4] ? Number(data[4]) : interval;\n    autoResize = undefined !== data[6] ? strBool(data[6]) : autoResize;\n    bodyMarginStr = data[7];\n    heightCalcMode = undefined !== data[8] ? data[8] : heightCalcMode;\n    bodyBackground = data[9];\n    bodyPadding = data[10];\n    tolerance = undefined !== data[11] ? Number(data[11]) : tolerance;\n    inPageLinks.enable = undefined !== data[12] ? strBool(data[12]) : false;\n    resizeFrom = undefined !== data[13] ? data[13] : resizeFrom;\n    widthCalcMode = undefined !== data[14] ? data[14] : widthCalcMode;\n  }\n\n  function readDataFromPage() {\n    function readData() {\n      var data = window.iFrameResizer;\n      log('Reading data from page: ' + JSON.stringify(data));\n      messageCallback = 'messageCallback' in data ? data.messageCallback : messageCallback;\n      readyCallback = 'readyCallback' in data ? data.readyCallback : readyCallback;\n      targetOriginDefault = 'targetOrigin' in data ? data.targetOrigin : targetOriginDefault;\n      heightCalcMode = 'heightCalculationMethod' in data ? data.heightCalculationMethod : heightCalcMode;\n      widthCalcMode = 'widthCalculationMethod' in data ? data.widthCalculationMethod : widthCalcMode;\n    }\n\n    function setupCustomCalcMethods(calcMode, calcFunc) {\n      if ('function' === typeof calcMode) {\n        log('Setup custom ' + calcFunc + 'CalcMethod');\n        customCalcMethods[calcFunc] = calcMode;\n        calcMode = 'custom';\n      }\n\n      return calcMode;\n    }\n\n    if ('iFrameResizer' in window && Object === window.iFrameResizer.constructor) {\n      readData();\n      heightCalcMode = setupCustomCalcMethods(heightCalcMode, 'height');\n      widthCalcMode = setupCustomCalcMethods(widthCalcMode, 'width');\n    }\n\n    log('TargetOrigin for parent set to: ' + targetOriginDefault);\n  }\n\n  function chkCSS(attr, value) {\n    if (-1 !== value.indexOf('-')) {\n      warn('Negative CSS value ignored for ' + attr);\n      value = '';\n    }\n\n    return value;\n  }\n\n  function setBodyStyle(attr, value) {\n    if (undefined !== value && '' !== value && 'null' !== value) {\n      document.body.style[attr] = value;\n      log('Body ' + attr + ' set to \"' + value + '\"');\n    }\n  }\n\n  function setMargin() {\n    //If called via V1 script, convert bodyMargin from int to str\n    if (undefined === bodyMarginStr) {\n      bodyMarginStr = bodyMargin + 'px';\n    }\n\n    setBodyStyle('margin', chkCSS('margin', bodyMarginStr));\n  }\n\n  function stopInfiniteResizingOfIFrame() {\n    document.documentElement.style.height = '';\n    document.body.style.height = '';\n    log('HTML & body height set to \"auto\"');\n  }\n\n  function manageTriggerEvent(options) {\n    var listener = {\n      add: function add(eventName) {\n        function handleEvent() {\n          sendSize(options.eventName, options.eventType);\n        }\n\n        eventHandlersByName[eventName] = handleEvent;\n        addEventListener(window, eventName, handleEvent, {\n          passive: true\n        });\n      },\n      remove: function remove(eventName) {\n        var handleEvent = eventHandlersByName[eventName];\n        delete eventHandlersByName[eventName];\n        removeEventListener(window, eventName, handleEvent);\n      }\n    };\n\n    if (options.eventNames && Array.prototype.map) {\n      options.eventName = options.eventNames[0];\n      options.eventNames.map(listener[options.method]);\n    } else {\n      listener[options.method](options.eventName);\n    }\n\n    log(capitalizeFirstLetter(options.method) + ' event listener: ' + options.eventType);\n  }\n\n  function manageEventListeners(method) {\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Animation Start',\n      eventNames: ['animationstart', 'webkitAnimationStart']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Animation Iteration',\n      eventNames: ['animationiteration', 'webkitAnimationIteration']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Animation End',\n      eventNames: ['animationend', 'webkitAnimationEnd']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Input',\n      eventName: 'input'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Mouse Up',\n      eventName: 'mouseup'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Mouse Down',\n      eventName: 'mousedown'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Orientation Change',\n      eventName: 'orientationchange'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Print',\n      eventName: ['afterprint', 'beforeprint']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Ready State Change',\n      eventName: 'readystatechange'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Touch Start',\n      eventName: 'touchstart'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Touch End',\n      eventName: 'touchend'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Touch Cancel',\n      eventName: 'touchcancel'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Transition Start',\n      eventNames: ['transitionstart', 'webkitTransitionStart', 'MSTransitionStart', 'oTransitionStart', 'otransitionstart']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Transition Iteration',\n      eventNames: ['transitioniteration', 'webkitTransitionIteration', 'MSTransitionIteration', 'oTransitionIteration', 'otransitioniteration']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Transition End',\n      eventNames: ['transitionend', 'webkitTransitionEnd', 'MSTransitionEnd', 'oTransitionEnd', 'otransitionend']\n    });\n\n    if ('child' === resizeFrom) {\n      manageTriggerEvent({\n        method: method,\n        eventType: 'IFrame Resized',\n        eventName: 'resize'\n      });\n    }\n  }\n\n  function checkCalcMode(calcMode, calcModeDefault, modes, type) {\n    if (calcModeDefault !== calcMode) {\n      if (!(calcMode in modes)) {\n        warn(calcMode + ' is not a valid option for ' + type + 'CalculationMethod.');\n        calcMode = calcModeDefault;\n      }\n\n      log(type + ' calculation method set to \"' + calcMode + '\"');\n    }\n\n    return calcMode;\n  }\n\n  function checkHeightMode() {\n    heightCalcMode = checkCalcMode(heightCalcMode, heightCalcModeDefault, getHeight, 'height');\n  }\n\n  function checkWidthMode() {\n    widthCalcMode = checkCalcMode(widthCalcMode, widthCalcModeDefault, getWidth, 'width');\n  }\n\n  function startEventListeners() {\n    if (true === autoResize) {\n      manageEventListeners('add');\n      setupMutationObserver();\n    } else {\n      log('Auto Resize disabled');\n    }\n  }\n\n  function stopMsgsToParent() {\n    log('Disable outgoing messages');\n    sendPermit = false;\n  }\n\n  function removeMsgListener() {\n    log('Remove event listener: Message');\n    removeEventListener(window, 'message', receiver);\n  }\n\n  function disconnectMutationObserver() {\n    if (null !== bodyObserver) {\n      /* istanbul ignore next */\n      // Not testable in PhantonJS\n      bodyObserver.disconnect();\n    }\n  }\n\n  function stopEventListeners() {\n    manageEventListeners('remove');\n    disconnectMutationObserver();\n    clearInterval(intervalTimer);\n  }\n\n  function teardown() {\n    stopMsgsToParent();\n    removeMsgListener();\n    if (true === autoResize) stopEventListeners();\n  }\n\n  function injectClearFixIntoBodyElement() {\n    var clearFix = document.createElement('div');\n    clearFix.style.clear = 'both';\n    clearFix.style.display = 'block'; //Guard against this having been globally redefined in CSS.\n\n    document.body.appendChild(clearFix);\n  }\n\n  function setupInPageLinks() {\n    function getPagePosition() {\n      return {\n        x: window.pageXOffset !== undefined ? window.pageXOffset : document.documentElement.scrollLeft,\n        y: window.pageYOffset !== undefined ? window.pageYOffset : document.documentElement.scrollTop\n      };\n    }\n\n    function getElementPosition(el) {\n      var elPosition = el.getBoundingClientRect(),\n          pagePosition = getPagePosition();\n      return {\n        x: parseInt(elPosition.left, 10) + parseInt(pagePosition.x, 10),\n        y: parseInt(elPosition.top, 10) + parseInt(pagePosition.y, 10)\n      };\n    }\n\n    function findTarget(location) {\n      function jumpToTarget(target) {\n        var jumpPosition = getElementPosition(target);\n        log('Moving to in page link (#' + hash + ') at x: ' + jumpPosition.x + ' y: ' + jumpPosition.y);\n        sendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n      }\n\n      var hash = location.split('#')[1] || location,\n          //Remove # if present\n      hashData = decodeURIComponent(hash),\n          target = document.getElementById(hashData) || document.getElementsByName(hashData)[0];\n\n      if (undefined !== target) {\n        jumpToTarget(target);\n      } else {\n        log('In page link (#' + hash + ') not found in iFrame, so sending to parent');\n        sendMsg(0, 0, 'inPageLink', '#' + hash);\n      }\n    }\n\n    function checkLocationHash() {\n      if ('' !== location.hash && '#' !== location.hash) {\n        findTarget(location.href);\n      }\n    }\n\n    function bindAnchors() {\n      function setupLink(el) {\n        function linkClicked(e) {\n          e.preventDefault();\n          /*jshint validthis:true */\n\n          findTarget(this.getAttribute('href'));\n        }\n\n        if ('#' !== el.getAttribute('href')) {\n          addEventListener(el, 'click', linkClicked);\n        }\n      }\n\n      Array.prototype.forEach.call(document.querySelectorAll('a[href^=\"#\"]'), setupLink);\n    }\n\n    function bindLocationHash() {\n      addEventListener(window, 'hashchange', checkLocationHash);\n    }\n\n    function initCheck() {\n      //check if page loaded with location hash after init resize\n      setTimeout(checkLocationHash, eventCancelTimer);\n    }\n\n    function enableInPageLinks() {\n      /* istanbul ignore else */\n      // Not testable in phantonJS\n      if (Array.prototype.forEach && document.querySelectorAll) {\n        log('Setting up location.hash handlers');\n        bindAnchors();\n        bindLocationHash();\n        initCheck();\n      } else {\n        warn('In page linking not fully supported in this browser! (See README.md for IE8 workaround)');\n      }\n    }\n\n    if (inPageLinks.enable) {\n      enableInPageLinks();\n    } else {\n      log('In page linking not enabled');\n    }\n\n    return {\n      findTarget: findTarget\n    };\n  }\n\n  function setupPublicMethods() {\n    log('Enable public methods');\n    win.parentIFrame = {\n      autoResize: function autoResizeF(resize) {\n        if (true === resize && false === autoResize) {\n          autoResize = true;\n          startEventListeners(); //sendSize('autoResize','Auto Resize enabled');\n        } else if (false === resize && true === autoResize) {\n          autoResize = false;\n          stopEventListeners();\n        }\n\n        return autoResize;\n      },\n      close: function closeF() {\n        sendMsg(0, 0, 'close');\n        teardown();\n      },\n      getId: function getIdF() {\n        return myID;\n      },\n      getPageInfo: function getPageInfoF(callback) {\n        if ('function' === typeof callback) {\n          pageInfoCallback = callback;\n          sendMsg(0, 0, 'pageInfo');\n        } else {\n          pageInfoCallback = function pageInfoCallback() {};\n\n          sendMsg(0, 0, 'pageInfoStop');\n        }\n      },\n      moveToAnchor: function moveToAnchorF(hash) {\n        inPageLinks.findTarget(hash);\n      },\n      reset: function resetF() {\n        resetIFrame('parentIFrame.reset');\n      },\n      scrollTo: function scrollToF(x, y) {\n        sendMsg(y, x, 'scrollTo'); // X&Y reversed at sendMsg uses height/width\n      },\n      scrollToOffset: function scrollToF(x, y) {\n        sendMsg(y, x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n      },\n      sendMessage: function sendMessageF(msg, targetOrigin) {\n        sendMsg(0, 0, 'message', JSON.stringify(msg), targetOrigin);\n      },\n      setHeightCalculationMethod: function setHeightCalculationMethodF(heightCalculationMethod) {\n        heightCalcMode = heightCalculationMethod;\n        checkHeightMode();\n      },\n      setWidthCalculationMethod: function setWidthCalculationMethodF(widthCalculationMethod) {\n        widthCalcMode = widthCalculationMethod;\n        checkWidthMode();\n      },\n      setTargetOrigin: function setTargetOriginF(targetOrigin) {\n        log('Set targetOrigin: ' + targetOrigin);\n        targetOriginDefault = targetOrigin;\n      },\n      size: function sizeF(customHeight, customWidth) {\n        var valString = '' + (customHeight ? customHeight : '') + (customWidth ? ',' + customWidth : ''); //lockTrigger();\n\n        sendSize('size', 'parentIFrame.size(' + valString + ')', customHeight, customWidth);\n      }\n    };\n  }\n\n  function initInterval() {\n    if (0 !== interval) {\n      log('setInterval: ' + interval + 'ms');\n      intervalTimer = setInterval(function () {\n        sendSize('interval', 'setInterval: ' + interval);\n      }, Math.abs(interval));\n    }\n  } //Not testable in PhantomJS\n\n  /* istanbul ignore next */\n\n\n  function setupBodyMutationObserver() {\n    function addImageLoadListners(mutation) {\n      function addImageLoadListener(element) {\n        if (false === element.complete) {\n          log('Attach listeners to ' + element.src);\n          element.addEventListener('load', imageLoaded, false);\n          element.addEventListener('error', imageError, false);\n          elements.push(element);\n        }\n      }\n\n      if (mutation.type === 'attributes' && mutation.attributeName === 'src') {\n        addImageLoadListener(mutation.target);\n      } else if (mutation.type === 'childList') {\n        Array.prototype.forEach.call(mutation.target.querySelectorAll('img'), addImageLoadListener);\n      }\n    }\n\n    function removeFromArray(element) {\n      elements.splice(elements.indexOf(element), 1);\n    }\n\n    function removeImageLoadListener(element) {\n      log('Remove listeners from ' + element.src);\n      element.removeEventListener('load', imageLoaded, false);\n      element.removeEventListener('error', imageError, false);\n      removeFromArray(element);\n    }\n\n    function imageEventTriggered(event, type, typeDesc) {\n      removeImageLoadListener(event.target);\n      sendSize(type, typeDesc + ': ' + event.target.src, undefined, undefined);\n    }\n\n    function imageLoaded(event) {\n      imageEventTriggered(event, 'imageLoad', 'Image loaded');\n    }\n\n    function imageError(event) {\n      imageEventTriggered(event, 'imageLoadFailed', 'Image load failed');\n    }\n\n    function mutationObserved(mutations) {\n      sendSize('mutationObserver', 'mutationObserver: ' + mutations[0].target + ' ' + mutations[0].type); //Deal with WebKit asyncing image loading when tags are injected into the page\n\n      mutations.forEach(addImageLoadListners);\n    }\n\n    function createMutationObserver() {\n      var target = document.querySelector('body'),\n          config = {\n        attributes: true,\n        attributeOldValue: false,\n        characterData: true,\n        characterDataOldValue: false,\n        childList: true,\n        subtree: true\n      };\n      observer = new MutationObserver(mutationObserved);\n      log('Create body MutationObserver');\n      observer.observe(target, config);\n      return observer;\n    }\n\n    var elements = [],\n        MutationObserver = window.MutationObserver || window.WebKitMutationObserver,\n        observer = createMutationObserver();\n    return {\n      disconnect: function disconnect() {\n        if ('disconnect' in observer) {\n          log('Disconnect body MutationObserver');\n          observer.disconnect();\n          elements.forEach(removeImageLoadListener);\n        }\n      }\n    };\n  }\n\n  function setupMutationObserver() {\n    var forceIntervalTimer = 0 > interval; // Not testable in PhantomJS\n\n    /* istanbul ignore if */\n\n    if (window.MutationObserver || window.WebKitMutationObserver) {\n      if (forceIntervalTimer) {\n        initInterval();\n      } else {\n        bodyObserver = setupBodyMutationObserver();\n      }\n    } else {\n      log('MutationObserver not supported in this browser!');\n      initInterval();\n    }\n  } // document.documentElement.offsetHeight is not reliable, so\n  // we have to jump through hoops to get a better value.\n\n\n  function getComputedStyle(prop, el) {\n    /* istanbul ignore next */\n    //Not testable in PhantomJS\n    function convertUnitsToPxForIE8(value) {\n      var PIXEL = /^\\d+(px)?$/i;\n\n      if (PIXEL.test(value)) {\n        return parseInt(value, base);\n      }\n\n      var style = el.style.left,\n          runtimeStyle = el.runtimeStyle.left;\n      el.runtimeStyle.left = el.currentStyle.left;\n      el.style.left = value || 0;\n      value = el.style.pixelLeft;\n      el.style.left = style;\n      el.runtimeStyle.left = runtimeStyle;\n      return value;\n    }\n\n    var retVal = 0;\n    el = el || document.body; // Not testable in phantonJS\n\n    /* istanbul ignore else */\n\n    if ('defaultView' in document && 'getComputedStyle' in document.defaultView) {\n      retVal = document.defaultView.getComputedStyle(el, null);\n      retVal = null !== retVal ? retVal[prop] : 0;\n    } else {\n      //IE8\n      retVal = convertUnitsToPxForIE8(el.currentStyle[prop]);\n    }\n\n    return parseInt(retVal, base);\n  }\n\n  function chkEventThottle(timer) {\n    if (timer > throttledTimer / 2) {\n      throttledTimer = 2 * timer;\n      log('Event throttle increased to ' + throttledTimer + 'ms');\n    }\n  } //Idea from https://github.com/guardian/iframe-messenger\n\n\n  function getMaxElement(side, elements) {\n    var elementsLength = elements.length,\n        elVal = 0,\n        maxVal = 0,\n        Side = capitalizeFirstLetter(side),\n        timer = getNow();\n\n    for (var i = 0; i < elementsLength; i++) {\n      elVal = elements[i].getBoundingClientRect()[side] + getComputedStyle('margin' + Side, elements[i]);\n\n      if (elVal > maxVal) {\n        maxVal = elVal;\n      }\n    }\n\n    timer = getNow() - timer;\n    log('Parsed ' + elementsLength + ' HTML elements');\n    log('Element position calculated in ' + timer + 'ms');\n    chkEventThottle(timer);\n    return maxVal;\n  }\n\n  function getAllMeasurements(dimention) {\n    return [dimention.bodyOffset(), dimention.bodyScroll(), dimention.documentElementOffset(), dimention.documentElementScroll()];\n  }\n\n  function getTaggedElements(side, tag) {\n    function noTaggedElementsFound() {\n      warn('No tagged elements (' + tag + ') found on page');\n      return document.querySelectorAll('body *');\n    }\n\n    var elements = document.querySelectorAll('[' + tag + ']');\n    if (0 === elements.length) noTaggedElementsFound();\n    return getMaxElement(side, elements);\n  }\n\n  function getAllElements() {\n    return document.querySelectorAll('body *');\n  }\n\n  var getHeight = {\n    bodyOffset: function getBodyOffsetHeight() {\n      return document.body.offsetHeight + getComputedStyle('marginTop') + getComputedStyle('marginBottom');\n    },\n    offset: function offset() {\n      return getHeight.bodyOffset(); //Backwards compatability\n    },\n    bodyScroll: function getBodyScrollHeight() {\n      return document.body.scrollHeight;\n    },\n    custom: function getCustomWidth() {\n      return customCalcMethods.height();\n    },\n    documentElementOffset: function getDEOffsetHeight() {\n      return document.documentElement.offsetHeight;\n    },\n    documentElementScroll: function getDEScrollHeight() {\n      return document.documentElement.scrollHeight;\n    },\n    max: function getMaxHeight() {\n      return Math.max.apply(null, getAllMeasurements(getHeight));\n    },\n    min: function getMinHeight() {\n      return Math.min.apply(null, getAllMeasurements(getHeight));\n    },\n    grow: function growHeight() {\n      return getHeight.max(); //Run max without the forced downsizing\n    },\n    lowestElement: function getBestHeight() {\n      return Math.max(getHeight.bodyOffset() || getHeight.documentElementOffset(), getMaxElement('bottom', getAllElements()));\n    },\n    taggedElement: function getTaggedElementsHeight() {\n      return getTaggedElements('bottom', 'data-iframe-height');\n    }\n  },\n      getWidth = {\n    bodyScroll: function getBodyScrollWidth() {\n      return document.body.scrollWidth;\n    },\n    bodyOffset: function getBodyOffsetWidth() {\n      return document.body.offsetWidth;\n    },\n    custom: function getCustomWidth() {\n      return customCalcMethods.width();\n    },\n    documentElementScroll: function getDEScrollWidth() {\n      return document.documentElement.scrollWidth;\n    },\n    documentElementOffset: function getDEOffsetWidth() {\n      return document.documentElement.offsetWidth;\n    },\n    scroll: function getMaxWidth() {\n      return Math.max(getWidth.bodyScroll(), getWidth.documentElementScroll());\n    },\n    max: function getMaxWidth() {\n      return Math.max.apply(null, getAllMeasurements(getWidth));\n    },\n    min: function getMinWidth() {\n      return Math.min.apply(null, getAllMeasurements(getWidth));\n    },\n    rightMostElement: function rightMostElement() {\n      return getMaxElement('right', getAllElements());\n    },\n    taggedElement: function getTaggedElementsWidth() {\n      return getTaggedElements('right', 'data-iframe-width');\n    }\n  };\n\n  function sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth) {\n    function resizeIFrame() {\n      height = currentHeight;\n      width = currentWidth;\n      sendMsg(height, width, triggerEvent);\n    }\n\n    function isSizeChangeDetected() {\n      function checkTolarance(a, b) {\n        var retVal = Math.abs(a - b) <= tolerance;\n        return !retVal;\n      }\n\n      currentHeight = undefined !== customHeight ? customHeight : getHeight[heightCalcMode]();\n      currentWidth = undefined !== customWidth ? customWidth : getWidth[widthCalcMode]();\n      return checkTolarance(height, currentHeight) || calculateWidth && checkTolarance(width, currentWidth);\n    }\n\n    function isForceResizableEvent() {\n      return !(triggerEvent in {\n        init: 1,\n        interval: 1,\n        size: 1\n      });\n    }\n\n    function isForceResizableCalcMode() {\n      return heightCalcMode in resetRequiredMethods || calculateWidth && widthCalcMode in resetRequiredMethods;\n    }\n\n    function logIgnored() {\n      log('No change in size detected');\n    }\n\n    function checkDownSizing() {\n      if (isForceResizableEvent() && isForceResizableCalcMode()) {\n        resetIFrame(triggerEventDesc);\n      } else if (!(triggerEvent in {\n        interval: 1\n      })) {\n        logIgnored();\n      }\n    }\n\n    var currentHeight, currentWidth;\n\n    if (isSizeChangeDetected() || 'init' === triggerEvent) {\n      lockTrigger();\n      resizeIFrame();\n    } else {\n      checkDownSizing();\n    }\n  }\n\n  var sizeIFrameThrottled = throttle(sizeIFrame);\n\n  function sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth) {\n    function recordTrigger() {\n      if (!(triggerEvent in {\n        reset: 1,\n        resetPage: 1,\n        init: 1\n      })) {\n        log('Trigger event: ' + triggerEventDesc);\n      }\n    }\n\n    function isDoubleFiredEvent() {\n      return triggerLocked && triggerEvent in doubleEventList;\n    }\n\n    if (!isDoubleFiredEvent()) {\n      recordTrigger();\n\n      if (triggerEvent === 'init') {\n        sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth);\n      } else {\n        sizeIFrameThrottled(triggerEvent, triggerEventDesc, customHeight, customWidth);\n      }\n    } else {\n      log('Trigger event cancelled: ' + triggerEvent);\n    }\n  }\n\n  function lockTrigger() {\n    if (!triggerLocked) {\n      triggerLocked = true;\n      log('Trigger event lock on');\n    }\n\n    clearTimeout(triggerLockedTimer);\n    triggerLockedTimer = setTimeout(function () {\n      triggerLocked = false;\n      log('Trigger event lock off');\n      log('--');\n    }, eventCancelTimer);\n  }\n\n  function triggerReset(triggerEvent) {\n    height = getHeight[heightCalcMode]();\n    width = getWidth[widthCalcMode]();\n    sendMsg(height, width, triggerEvent);\n  }\n\n  function resetIFrame(triggerEventDesc) {\n    var hcm = heightCalcMode;\n    heightCalcMode = heightCalcModeDefault;\n    log('Reset trigger event: ' + triggerEventDesc);\n    lockTrigger();\n    triggerReset('reset');\n    heightCalcMode = hcm;\n  }\n\n  function sendMsg(height, width, triggerEvent, msg, targetOrigin) {\n    function setTargetOrigin() {\n      if (undefined === targetOrigin) {\n        targetOrigin = targetOriginDefault;\n      } else {\n        log('Message targetOrigin: ' + targetOrigin);\n      }\n    }\n\n    function sendToParent() {\n      var size = height + ':' + width,\n          message = myID + ':' + size + ':' + triggerEvent + (undefined !== msg ? ':' + msg : '');\n      log('Sending message to host page (' + message + ')');\n      target.postMessage(msgID + message, targetOrigin);\n    }\n\n    if (true === sendPermit) {\n      setTargetOrigin();\n      sendToParent();\n    }\n  }\n\n  function receiver(event) {\n    var processRequestFromParent = {\n      init: function initFromParent() {\n        initMsg = event.data;\n        target = event.source;\n        init();\n        firstRun = false;\n        setTimeout(function () {\n          initLock = false;\n        }, eventCancelTimer);\n      },\n      reset: function resetFromParent() {\n        if (!initLock) {\n          log('Page size reset by host page');\n          triggerReset('resetPage');\n        } else {\n          log('Page reset ignored by init');\n        }\n      },\n      resize: function resizeFromParent() {\n        sendSize('resizeParent', 'Parent window requested size check');\n      },\n      moveToAnchor: function moveToAnchorF() {\n        inPageLinks.findTarget(getData());\n      },\n      inPageLink: function inPageLinkF() {\n        this.moveToAnchor();\n      },\n      //Backward compatability\n      pageInfo: function pageInfoFromParent() {\n        var msgBody = getData();\n        log('PageInfoFromParent called from parent: ' + msgBody);\n        pageInfoCallback(JSON.parse(msgBody));\n        log(' --');\n      },\n      message: function messageFromParent() {\n        var msgBody = getData();\n        log('MessageCallback called from parent: ' + msgBody);\n        messageCallback(JSON.parse(msgBody));\n        log(' --');\n      }\n    };\n\n    function isMessageForUs() {\n      return msgID === ('' + event.data).substr(0, msgIdLen); //''+ Protects against non-string messages\n    }\n\n    function getMessageType() {\n      return event.data.split(']')[1].split(':')[0];\n    }\n\n    function getData() {\n      return event.data.substr(event.data.indexOf(':') + 1);\n    }\n\n    function isMiddleTier() {\n      return !(typeof module !== 'undefined' && module.exports) && 'iFrameResize' in window || 'jQuery' in window && 'iFrameResize' in window.jQuery.prototype;\n    }\n\n    function isInitMsg() {\n      //Test if this message is from a child below us. This is an ugly test, however, updating\n      //the message format would break backwards compatibity.\n      return event.data.split(':')[2] in {\n        true: 1,\n        false: 1\n      };\n    }\n\n    function callFromParent() {\n      var messageType = getMessageType();\n\n      if (messageType in processRequestFromParent) {\n        processRequestFromParent[messageType]();\n      } else if (!isMiddleTier() && !isInitMsg()) {\n        warn('Unexpected message (' + event.data + ')');\n      }\n    }\n\n    function processMessage() {\n      if (false === firstRun) {\n        callFromParent();\n      } else if (isInitMsg()) {\n        processRequestFromParent.init();\n      } else {\n        log('Ignored message of type \"' + getMessageType() + '\". Received before initialization.');\n      }\n    }\n\n    if (isMessageForUs()) {\n      processMessage();\n    }\n  } //Normally the parent kicks things off when it detects the iFrame has loaded.\n  //If this script is async-loaded, then tell parent page to retry init.\n\n\n  function chkLateLoaded() {\n    if ('loading' !== document.readyState) {\n      window.parent.postMessage('[iFrameResizerChild]Ready', '*');\n    }\n  }\n\n  addEventListener(window, 'message', receiver);\n  addEventListener(window, 'readystatechange', chkLateLoaded);\n  chkLateLoaded();\n})();","map":{"version":3,"sources":["D:/Python files/Start Django/blog_tube/frontend/blog_tube/node_modules/iframe-resizer/js/iframeResizer.contentWindow.js"],"names":["undefined","window","autoResize","base","bodyBackground","bodyMargin","bodyMarginStr","bodyObserver","bodyPadding","calculateWidth","doubleEventList","resize","click","eventCancelTimer","firstRun","height","heightCalcModeDefault","heightCalcMode","initLock","initMsg","inPageLinks","interval","intervalTimer","logging","msgID","msgIdLen","length","myID","observer","resetRequiredMethods","max","min","bodyScroll","documentElementScroll","resizeFrom","sendPermit","target","parent","targetOriginDefault","tolerance","triggerLocked","triggerLockedTimer","throttledTimer","width","widthCalcModeDefault","widthCalcMode","win","messageCallback","warn","readyCallback","pageInfoCallback","customCalcMethods","document","documentElement","offsetHeight","body","scrollWidth","eventHandlersByName","passiveSupported","onceSupported","noop","options","Object","create","passive","get","once","addEventListener","removeEventListener","e","el","evt","func","attachEvent","detachEvent","capitalizeFirstLetter","string","charAt","toUpperCase","slice","throttle","context","args","result","timeout","previous","later","getNow","apply","now","remaining","arguments","clearTimeout","setTimeout","Date","getTime","formatLogMsg","msg","log","console","init","readDataFromParent","location","href","readDataFromPage","setMargin","setBodyStyle","injectClearFixIntoBodyElement","checkHeightMode","checkWidthMode","stopInfiniteResizingOfIFrame","setupPublicMethods","startEventListeners","setupInPageLinks","sendSize","strBool","str","data","substr","split","Number","enable","readData","iFrameResizer","JSON","stringify","targetOrigin","heightCalculationMethod","widthCalculationMethod","setupCustomCalcMethods","calcMode","calcFunc","constructor","chkCSS","attr","value","indexOf","style","manageTriggerEvent","listener","add","eventName","handleEvent","eventType","remove","eventNames","Array","prototype","map","method","manageEventListeners","checkCalcMode","calcModeDefault","modes","type","getHeight","getWidth","setupMutationObserver","stopMsgsToParent","removeMsgListener","receiver","disconnectMutationObserver","disconnect","stopEventListeners","clearInterval","teardown","clearFix","createElement","clear","display","appendChild","getPagePosition","x","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","getElementPosition","elPosition","getBoundingClientRect","pagePosition","parseInt","left","top","findTarget","jumpToTarget","jumpPosition","hash","sendMsg","hashData","decodeURIComponent","getElementById","getElementsByName","checkLocationHash","bindAnchors","setupLink","linkClicked","preventDefault","getAttribute","forEach","call","querySelectorAll","bindLocationHash","initCheck","enableInPageLinks","parentIFrame","autoResizeF","close","closeF","getId","getIdF","getPageInfo","getPageInfoF","callback","moveToAnchor","moveToAnchorF","reset","resetF","resetIFrame","scrollTo","scrollToF","scrollToOffset","sendMessage","sendMessageF","setHeightCalculationMethod","setHeightCalculationMethodF","setWidthCalculationMethod","setWidthCalculationMethodF","setTargetOrigin","setTargetOriginF","size","sizeF","customHeight","customWidth","valString","initInterval","setInterval","Math","abs","setupBodyMutationObserver","addImageLoadListners","mutation","addImageLoadListener","element","complete","src","imageLoaded","imageError","elements","push","attributeName","removeFromArray","splice","removeImageLoadListener","imageEventTriggered","event","typeDesc","mutationObserved","mutations","createMutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","MutationObserver","observe","WebKitMutationObserver","forceIntervalTimer","getComputedStyle","prop","convertUnitsToPxForIE8","PIXEL","test","runtimeStyle","currentStyle","pixelLeft","retVal","defaultView","chkEventThottle","timer","getMaxElement","side","elementsLength","elVal","maxVal","Side","i","getAllMeasurements","dimention","bodyOffset","documentElementOffset","getTaggedElements","tag","noTaggedElementsFound","getAllElements","getBodyOffsetHeight","offset","getBodyScrollHeight","scrollHeight","custom","getCustomWidth","getDEOffsetHeight","getDEScrollHeight","getMaxHeight","getMinHeight","grow","growHeight","lowestElement","getBestHeight","taggedElement","getTaggedElementsHeight","getBodyScrollWidth","getBodyOffsetWidth","offsetWidth","getDEScrollWidth","getDEOffsetWidth","scroll","getMaxWidth","getMinWidth","rightMostElement","getTaggedElementsWidth","sizeIFrame","triggerEvent","triggerEventDesc","resizeIFrame","currentHeight","currentWidth","isSizeChangeDetected","checkTolarance","a","b","isForceResizableEvent","isForceResizableCalcMode","logIgnored","checkDownSizing","lockTrigger","sizeIFrameThrottled","recordTrigger","resetPage","isDoubleFiredEvent","triggerReset","hcm","sendToParent","message","postMessage","processRequestFromParent","initFromParent","source","resetFromParent","resizeFromParent","getData","inPageLink","inPageLinkF","pageInfo","pageInfoFromParent","msgBody","parse","messageFromParent","isMessageForUs","getMessageType","isMiddleTier","module","exports","jQuery","isInitMsg","true","false","callFromParent","messageType","processMessage","chkLateLoaded","readyState"],"mappings":"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","sourcesContent":["/*\n * File: iframeResizer.contentWindow.js\n * Desc: Include this file in any page being loaded into an iframe\n *       to force the iframe to resize to the content size.\n * Requires: iframeResizer.js on host page.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n * Contributor: Jure Mav - jure.mav@gmail.com\n * Contributor: Ian Caunce - ian@hallnet.co.uk\n */\n\n(function(undefined) {\n  'use strict';\n\n  if (typeof window === 'undefined') return; // don't run for server side render\n\n  var autoResize = true,\n    base = 10,\n    bodyBackground = '',\n    bodyMargin = 0,\n    bodyMarginStr = '',\n    bodyObserver = null,\n    bodyPadding = '',\n    calculateWidth = false,\n    doubleEventList = { resize: 1, click: 1 },\n    eventCancelTimer = 128,\n    firstRun = true,\n    height = 1,\n    heightCalcModeDefault = 'bodyOffset',\n    heightCalcMode = heightCalcModeDefault,\n    initLock = true,\n    initMsg = '',\n    inPageLinks = {},\n    interval = 32,\n    intervalTimer = null,\n    logging = false,\n    msgID = '[iFrameSizer]', //Must match host page msg ID\n    msgIdLen = msgID.length,\n    myID = '',\n    observer = null,\n    resetRequiredMethods = {\n      max: 1,\n      min: 1,\n      bodyScroll: 1,\n      documentElementScroll: 1\n    },\n    resizeFrom = 'child',\n    sendPermit = true,\n    target = window.parent,\n    targetOriginDefault = '*',\n    tolerance = 0,\n    triggerLocked = false,\n    triggerLockedTimer = null,\n    throttledTimer = 16,\n    width = 1,\n    widthCalcModeDefault = 'scroll',\n    widthCalcMode = widthCalcModeDefault,\n    win = window,\n    messageCallback = function() {\n      warn('MessageCallback function not defined');\n    },\n    readyCallback = function() {},\n    pageInfoCallback = function() {},\n    customCalcMethods = {\n      height: function() {\n        warn('Custom height calculation function not defined');\n        return document.documentElement.offsetHeight;\n      },\n      width: function() {\n        warn('Custom width calculation function not defined');\n        return document.body.scrollWidth;\n      }\n    },\n    eventHandlersByName = {},\n    passiveSupported = false,\n    onceSupported = false;\n\n  function noop() {}\n\n  try {\n    var options = Object.create(\n      {},\n      {\n        passive: {\n          get: function() {\n            passiveSupported = true;\n          }\n        },\n        once: {\n          get: function() {\n            onceSupported = true;\n          }\n        }\n      }\n    );\n    window.addEventListener('test', noop, options);\n    window.removeEventListener('test', noop, options);\n  } catch (e) {\n    /* */\n  }\n\n  function addEventListener(el, evt, func, options) {\n    /* istanbul ignore else */ // Not testable in phantomJS\n    if ('addEventListener' in window) {\n      el.addEventListener(evt, func, passiveSupported ? options || {} : false);\n    } else if ('attachEvent' in window) {\n      //IE\n      el.attachEvent('on' + evt, func);\n    }\n  }\n\n  function removeEventListener(el, evt, func) {\n    /* istanbul ignore else */ // Not testable in phantomJS\n    if ('removeEventListener' in window) {\n      el.removeEventListener(evt, func, false);\n    } else if ('detachEvent' in window) {\n      //IE\n      el.detachEvent('on' + evt, func);\n    }\n  }\n\n  function capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n  }\n\n  //Based on underscore.js\n  function throttle(func) {\n    var context,\n      args,\n      result,\n      timeout = null,\n      previous = 0,\n      later = function() {\n        previous = getNow();\n        timeout = null;\n        result = func.apply(context, args);\n        if (!timeout) {\n          context = args = null;\n        }\n      };\n\n    return function() {\n      var now = getNow();\n\n      if (!previous) {\n        previous = now;\n      }\n\n      var remaining = throttledTimer - (now - previous);\n\n      context = this;\n      args = arguments;\n\n      if (remaining <= 0 || remaining > throttledTimer) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n\n        previous = now;\n        result = func.apply(context, args);\n\n        if (!timeout) {\n          context = args = null;\n        }\n      } else if (!timeout) {\n        timeout = setTimeout(later, remaining);\n      }\n\n      return result;\n    };\n  }\n\n  var getNow =\n    Date.now ||\n    function() {\n      /* istanbul ignore next */ // Not testable in PhantonJS\n      return new Date().getTime();\n    };\n\n  function formatLogMsg(msg) {\n    return msgID + '[' + myID + ']' + ' ' + msg;\n  }\n\n  function log(msg) {\n    if (logging && 'object' === typeof window.console) {\n      console.log(formatLogMsg(msg));\n    }\n  }\n\n  function warn(msg) {\n    if ('object' === typeof window.console) {\n      console.warn(formatLogMsg(msg));\n    }\n  }\n\n  function init() {\n    readDataFromParent();\n    log('Initialising iFrame (' + location.href + ')');\n    readDataFromPage();\n    setMargin();\n    setBodyStyle('background', bodyBackground);\n    setBodyStyle('padding', bodyPadding);\n    injectClearFixIntoBodyElement();\n    checkHeightMode();\n    checkWidthMode();\n    stopInfiniteResizingOfIFrame();\n    setupPublicMethods();\n    startEventListeners();\n    inPageLinks = setupInPageLinks();\n    sendSize('init', 'Init message from host page');\n    readyCallback();\n  }\n\n  function readDataFromParent() {\n    function strBool(str) {\n      return 'true' === str ? true : false;\n    }\n\n    var data = initMsg.substr(msgIdLen).split(':');\n\n    myID = data[0];\n    bodyMargin = undefined !== data[1] ? Number(data[1]) : bodyMargin; //For V1 compatibility\n    calculateWidth = undefined !== data[2] ? strBool(data[2]) : calculateWidth;\n    logging = undefined !== data[3] ? strBool(data[3]) : logging;\n    interval = undefined !== data[4] ? Number(data[4]) : interval;\n    autoResize = undefined !== data[6] ? strBool(data[6]) : autoResize;\n    bodyMarginStr = data[7];\n    heightCalcMode = undefined !== data[8] ? data[8] : heightCalcMode;\n    bodyBackground = data[9];\n    bodyPadding = data[10];\n    tolerance = undefined !== data[11] ? Number(data[11]) : tolerance;\n    inPageLinks.enable = undefined !== data[12] ? strBool(data[12]) : false;\n    resizeFrom = undefined !== data[13] ? data[13] : resizeFrom;\n    widthCalcMode = undefined !== data[14] ? data[14] : widthCalcMode;\n  }\n\n  function readDataFromPage() {\n    function readData() {\n      var data = window.iFrameResizer;\n\n      log('Reading data from page: ' + JSON.stringify(data));\n\n      messageCallback =\n        'messageCallback' in data ? data.messageCallback : messageCallback;\n      readyCallback =\n        'readyCallback' in data ? data.readyCallback : readyCallback;\n      targetOriginDefault =\n        'targetOrigin' in data ? data.targetOrigin : targetOriginDefault;\n      heightCalcMode =\n        'heightCalculationMethod' in data\n          ? data.heightCalculationMethod\n          : heightCalcMode;\n      widthCalcMode =\n        'widthCalculationMethod' in data\n          ? data.widthCalculationMethod\n          : widthCalcMode;\n    }\n\n    function setupCustomCalcMethods(calcMode, calcFunc) {\n      if ('function' === typeof calcMode) {\n        log('Setup custom ' + calcFunc + 'CalcMethod');\n        customCalcMethods[calcFunc] = calcMode;\n        calcMode = 'custom';\n      }\n\n      return calcMode;\n    }\n\n    if (\n      'iFrameResizer' in window &&\n      Object === window.iFrameResizer.constructor\n    ) {\n      readData();\n      heightCalcMode = setupCustomCalcMethods(heightCalcMode, 'height');\n      widthCalcMode = setupCustomCalcMethods(widthCalcMode, 'width');\n    }\n\n    log('TargetOrigin for parent set to: ' + targetOriginDefault);\n  }\n\n  function chkCSS(attr, value) {\n    if (-1 !== value.indexOf('-')) {\n      warn('Negative CSS value ignored for ' + attr);\n      value = '';\n    }\n    return value;\n  }\n\n  function setBodyStyle(attr, value) {\n    if (undefined !== value && '' !== value && 'null' !== value) {\n      document.body.style[attr] = value;\n      log('Body ' + attr + ' set to \"' + value + '\"');\n    }\n  }\n\n  function setMargin() {\n    //If called via V1 script, convert bodyMargin from int to str\n    if (undefined === bodyMarginStr) {\n      bodyMarginStr = bodyMargin + 'px';\n    }\n\n    setBodyStyle('margin', chkCSS('margin', bodyMarginStr));\n  }\n\n  function stopInfiniteResizingOfIFrame() {\n    document.documentElement.style.height = '';\n    document.body.style.height = '';\n    log('HTML & body height set to \"auto\"');\n  }\n\n  function manageTriggerEvent(options) {\n    var listener = {\n      add: function(eventName) {\n        function handleEvent() {\n          sendSize(options.eventName, options.eventType);\n        }\n\n        eventHandlersByName[eventName] = handleEvent;\n\n        addEventListener(window, eventName, handleEvent, { passive: true });\n      },\n      remove: function(eventName) {\n        var handleEvent = eventHandlersByName[eventName];\n        delete eventHandlersByName[eventName];\n\n        removeEventListener(window, eventName, handleEvent);\n      }\n    };\n\n    if (options.eventNames && Array.prototype.map) {\n      options.eventName = options.eventNames[0];\n      options.eventNames.map(listener[options.method]);\n    } else {\n      listener[options.method](options.eventName);\n    }\n\n    log(\n      capitalizeFirstLetter(options.method) +\n        ' event listener: ' +\n        options.eventType\n    );\n  }\n\n  function manageEventListeners(method) {\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Animation Start',\n      eventNames: ['animationstart', 'webkitAnimationStart']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Animation Iteration',\n      eventNames: ['animationiteration', 'webkitAnimationIteration']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Animation End',\n      eventNames: ['animationend', 'webkitAnimationEnd']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Input',\n      eventName: 'input'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Mouse Up',\n      eventName: 'mouseup'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Mouse Down',\n      eventName: 'mousedown'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Orientation Change',\n      eventName: 'orientationchange'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Print',\n      eventName: ['afterprint', 'beforeprint']\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Ready State Change',\n      eventName: 'readystatechange'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Touch Start',\n      eventName: 'touchstart'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Touch End',\n      eventName: 'touchend'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Touch Cancel',\n      eventName: 'touchcancel'\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Transition Start',\n      eventNames: [\n        'transitionstart',\n        'webkitTransitionStart',\n        'MSTransitionStart',\n        'oTransitionStart',\n        'otransitionstart'\n      ]\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Transition Iteration',\n      eventNames: [\n        'transitioniteration',\n        'webkitTransitionIteration',\n        'MSTransitionIteration',\n        'oTransitionIteration',\n        'otransitioniteration'\n      ]\n    });\n    manageTriggerEvent({\n      method: method,\n      eventType: 'Transition End',\n      eventNames: [\n        'transitionend',\n        'webkitTransitionEnd',\n        'MSTransitionEnd',\n        'oTransitionEnd',\n        'otransitionend'\n      ]\n    });\n    if ('child' === resizeFrom) {\n      manageTriggerEvent({\n        method: method,\n        eventType: 'IFrame Resized',\n        eventName: 'resize'\n      });\n    }\n  }\n\n  function checkCalcMode(calcMode, calcModeDefault, modes, type) {\n    if (calcModeDefault !== calcMode) {\n      if (!(calcMode in modes)) {\n        warn(\n          calcMode + ' is not a valid option for ' + type + 'CalculationMethod.'\n        );\n        calcMode = calcModeDefault;\n      }\n      log(type + ' calculation method set to \"' + calcMode + '\"');\n    }\n\n    return calcMode;\n  }\n\n  function checkHeightMode() {\n    heightCalcMode = checkCalcMode(\n      heightCalcMode,\n      heightCalcModeDefault,\n      getHeight,\n      'height'\n    );\n  }\n\n  function checkWidthMode() {\n    widthCalcMode = checkCalcMode(\n      widthCalcMode,\n      widthCalcModeDefault,\n      getWidth,\n      'width'\n    );\n  }\n\n  function startEventListeners() {\n    if (true === autoResize) {\n      manageEventListeners('add');\n      setupMutationObserver();\n    } else {\n      log('Auto Resize disabled');\n    }\n  }\n\n  function stopMsgsToParent() {\n    log('Disable outgoing messages');\n    sendPermit = false;\n  }\n\n  function removeMsgListener() {\n    log('Remove event listener: Message');\n    removeEventListener(window, 'message', receiver);\n  }\n\n  function disconnectMutationObserver() {\n    if (null !== bodyObserver) {\n      /* istanbul ignore next */ // Not testable in PhantonJS\n      bodyObserver.disconnect();\n    }\n  }\n\n  function stopEventListeners() {\n    manageEventListeners('remove');\n    disconnectMutationObserver();\n    clearInterval(intervalTimer);\n  }\n\n  function teardown() {\n    stopMsgsToParent();\n    removeMsgListener();\n    if (true === autoResize) stopEventListeners();\n  }\n\n  function injectClearFixIntoBodyElement() {\n    var clearFix = document.createElement('div');\n    clearFix.style.clear = 'both';\n    clearFix.style.display = 'block'; //Guard against this having been globally redefined in CSS.\n    document.body.appendChild(clearFix);\n  }\n\n  function setupInPageLinks() {\n    function getPagePosition() {\n      return {\n        x:\n          window.pageXOffset !== undefined\n            ? window.pageXOffset\n            : document.documentElement.scrollLeft,\n        y:\n          window.pageYOffset !== undefined\n            ? window.pageYOffset\n            : document.documentElement.scrollTop\n      };\n    }\n\n    function getElementPosition(el) {\n      var elPosition = el.getBoundingClientRect(),\n        pagePosition = getPagePosition();\n\n      return {\n        x: parseInt(elPosition.left, 10) + parseInt(pagePosition.x, 10),\n        y: parseInt(elPosition.top, 10) + parseInt(pagePosition.y, 10)\n      };\n    }\n\n    function findTarget(location) {\n      function jumpToTarget(target) {\n        var jumpPosition = getElementPosition(target);\n\n        log(\n          'Moving to in page link (#' +\n            hash +\n            ') at x: ' +\n            jumpPosition.x +\n            ' y: ' +\n            jumpPosition.y\n        );\n        sendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n      }\n\n      var hash = location.split('#')[1] || location, //Remove # if present\n        hashData = decodeURIComponent(hash),\n        target =\n          document.getElementById(hashData) ||\n          document.getElementsByName(hashData)[0];\n\n      if (undefined !== target) {\n        jumpToTarget(target);\n      } else {\n        log(\n          'In page link (#' +\n            hash +\n            ') not found in iFrame, so sending to parent'\n        );\n        sendMsg(0, 0, 'inPageLink', '#' + hash);\n      }\n    }\n\n    function checkLocationHash() {\n      if ('' !== location.hash && '#' !== location.hash) {\n        findTarget(location.href);\n      }\n    }\n\n    function bindAnchors() {\n      function setupLink(el) {\n        function linkClicked(e) {\n          e.preventDefault();\n\n          /*jshint validthis:true */\n          findTarget(this.getAttribute('href'));\n        }\n\n        if ('#' !== el.getAttribute('href')) {\n          addEventListener(el, 'click', linkClicked);\n        }\n      }\n\n      Array.prototype.forEach.call(\n        document.querySelectorAll('a[href^=\"#\"]'),\n        setupLink\n      );\n    }\n\n    function bindLocationHash() {\n      addEventListener(window, 'hashchange', checkLocationHash);\n    }\n\n    function initCheck() {\n      //check if page loaded with location hash after init resize\n      setTimeout(checkLocationHash, eventCancelTimer);\n    }\n\n    function enableInPageLinks() {\n      /* istanbul ignore else */ // Not testable in phantonJS\n      if (Array.prototype.forEach && document.querySelectorAll) {\n        log('Setting up location.hash handlers');\n        bindAnchors();\n        bindLocationHash();\n        initCheck();\n      } else {\n        warn(\n          'In page linking not fully supported in this browser! (See README.md for IE8 workaround)'\n        );\n      }\n    }\n\n    if (inPageLinks.enable) {\n      enableInPageLinks();\n    } else {\n      log('In page linking not enabled');\n    }\n\n    return {\n      findTarget: findTarget\n    };\n  }\n\n  function setupPublicMethods() {\n    log('Enable public methods');\n\n    win.parentIFrame = {\n      autoResize: function autoResizeF(resize) {\n        if (true === resize && false === autoResize) {\n          autoResize = true;\n          startEventListeners();\n          //sendSize('autoResize','Auto Resize enabled');\n        } else if (false === resize && true === autoResize) {\n          autoResize = false;\n          stopEventListeners();\n        }\n\n        return autoResize;\n      },\n\n      close: function closeF() {\n        sendMsg(0, 0, 'close');\n        teardown();\n      },\n\n      getId: function getIdF() {\n        return myID;\n      },\n\n      getPageInfo: function getPageInfoF(callback) {\n        if ('function' === typeof callback) {\n          pageInfoCallback = callback;\n          sendMsg(0, 0, 'pageInfo');\n        } else {\n          pageInfoCallback = function() {};\n          sendMsg(0, 0, 'pageInfoStop');\n        }\n      },\n\n      moveToAnchor: function moveToAnchorF(hash) {\n        inPageLinks.findTarget(hash);\n      },\n\n      reset: function resetF() {\n        resetIFrame('parentIFrame.reset');\n      },\n\n      scrollTo: function scrollToF(x, y) {\n        sendMsg(y, x, 'scrollTo'); // X&Y reversed at sendMsg uses height/width\n      },\n\n      scrollToOffset: function scrollToF(x, y) {\n        sendMsg(y, x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n      },\n\n      sendMessage: function sendMessageF(msg, targetOrigin) {\n        sendMsg(0, 0, 'message', JSON.stringify(msg), targetOrigin);\n      },\n\n      setHeightCalculationMethod: function setHeightCalculationMethodF(\n        heightCalculationMethod\n      ) {\n        heightCalcMode = heightCalculationMethod;\n        checkHeightMode();\n      },\n\n      setWidthCalculationMethod: function setWidthCalculationMethodF(\n        widthCalculationMethod\n      ) {\n        widthCalcMode = widthCalculationMethod;\n        checkWidthMode();\n      },\n\n      setTargetOrigin: function setTargetOriginF(targetOrigin) {\n        log('Set targetOrigin: ' + targetOrigin);\n        targetOriginDefault = targetOrigin;\n      },\n\n      size: function sizeF(customHeight, customWidth) {\n        var valString =\n          '' +\n          (customHeight ? customHeight : '') +\n          (customWidth ? ',' + customWidth : '');\n        //lockTrigger();\n        sendSize(\n          'size',\n          'parentIFrame.size(' + valString + ')',\n          customHeight,\n          customWidth\n        );\n      }\n    };\n  }\n\n  function initInterval() {\n    if (0 !== interval) {\n      log('setInterval: ' + interval + 'ms');\n      intervalTimer = setInterval(function() {\n        sendSize('interval', 'setInterval: ' + interval);\n      }, Math.abs(interval));\n    }\n  } //Not testable in PhantomJS\n\n  /* istanbul ignore next */ function setupBodyMutationObserver() {\n    function addImageLoadListners(mutation) {\n      function addImageLoadListener(element) {\n        if (false === element.complete) {\n          log('Attach listeners to ' + element.src);\n          element.addEventListener('load', imageLoaded, false);\n          element.addEventListener('error', imageError, false);\n          elements.push(element);\n        }\n      }\n\n      if (mutation.type === 'attributes' && mutation.attributeName === 'src') {\n        addImageLoadListener(mutation.target);\n      } else if (mutation.type === 'childList') {\n        Array.prototype.forEach.call(\n          mutation.target.querySelectorAll('img'),\n          addImageLoadListener\n        );\n      }\n    }\n\n    function removeFromArray(element) {\n      elements.splice(elements.indexOf(element), 1);\n    }\n\n    function removeImageLoadListener(element) {\n      log('Remove listeners from ' + element.src);\n      element.removeEventListener('load', imageLoaded, false);\n      element.removeEventListener('error', imageError, false);\n      removeFromArray(element);\n    }\n\n    function imageEventTriggered(event, type, typeDesc) {\n      removeImageLoadListener(event.target);\n      sendSize(type, typeDesc + ': ' + event.target.src, undefined, undefined);\n    }\n\n    function imageLoaded(event) {\n      imageEventTriggered(event, 'imageLoad', 'Image loaded');\n    }\n\n    function imageError(event) {\n      imageEventTriggered(event, 'imageLoadFailed', 'Image load failed');\n    }\n\n    function mutationObserved(mutations) {\n      sendSize(\n        'mutationObserver',\n        'mutationObserver: ' + mutations[0].target + ' ' + mutations[0].type\n      );\n\n      //Deal with WebKit asyncing image loading when tags are injected into the page\n      mutations.forEach(addImageLoadListners);\n    }\n\n    function createMutationObserver() {\n      var target = document.querySelector('body'),\n        config = {\n          attributes: true,\n          attributeOldValue: false,\n          characterData: true,\n          characterDataOldValue: false,\n          childList: true,\n          subtree: true\n        };\n\n      observer = new MutationObserver(mutationObserved);\n\n      log('Create body MutationObserver');\n      observer.observe(target, config);\n\n      return observer;\n    }\n\n    var elements = [],\n      MutationObserver =\n        window.MutationObserver || window.WebKitMutationObserver,\n      observer = createMutationObserver();\n\n    return {\n      disconnect: function() {\n        if ('disconnect' in observer) {\n          log('Disconnect body MutationObserver');\n          observer.disconnect();\n          elements.forEach(removeImageLoadListener);\n        }\n      }\n    };\n  }\n\n  function setupMutationObserver() {\n    var forceIntervalTimer = 0 > interval; // Not testable in PhantomJS\n\n    /* istanbul ignore if */ if (\n      window.MutationObserver ||\n      window.WebKitMutationObserver\n    ) {\n      if (forceIntervalTimer) {\n        initInterval();\n      } else {\n        bodyObserver = setupBodyMutationObserver();\n      }\n    } else {\n      log('MutationObserver not supported in this browser!');\n      initInterval();\n    }\n  }\n\n  // document.documentElement.offsetHeight is not reliable, so\n  // we have to jump through hoops to get a better value.\n  function getComputedStyle(prop, el) {\n    /* istanbul ignore next */ //Not testable in PhantomJS\n    function convertUnitsToPxForIE8(value) {\n      var PIXEL = /^\\d+(px)?$/i;\n\n      if (PIXEL.test(value)) {\n        return parseInt(value, base);\n      }\n\n      var style = el.style.left,\n        runtimeStyle = el.runtimeStyle.left;\n\n      el.runtimeStyle.left = el.currentStyle.left;\n      el.style.left = value || 0;\n      value = el.style.pixelLeft;\n      el.style.left = style;\n      el.runtimeStyle.left = runtimeStyle;\n\n      return value;\n    }\n\n    var retVal = 0;\n    el = el || document.body; // Not testable in phantonJS\n\n    /* istanbul ignore else */ if (\n      'defaultView' in document &&\n      'getComputedStyle' in document.defaultView\n    ) {\n      retVal = document.defaultView.getComputedStyle(el, null);\n      retVal = null !== retVal ? retVal[prop] : 0;\n    } else {\n      //IE8\n      retVal = convertUnitsToPxForIE8(el.currentStyle[prop]);\n    }\n\n    return parseInt(retVal, base);\n  }\n\n  function chkEventThottle(timer) {\n    if (timer > throttledTimer / 2) {\n      throttledTimer = 2 * timer;\n      log('Event throttle increased to ' + throttledTimer + 'ms');\n    }\n  }\n\n  //Idea from https://github.com/guardian/iframe-messenger\n  function getMaxElement(side, elements) {\n    var elementsLength = elements.length,\n      elVal = 0,\n      maxVal = 0,\n      Side = capitalizeFirstLetter(side),\n      timer = getNow();\n\n    for (var i = 0; i < elementsLength; i++) {\n      elVal =\n        elements[i].getBoundingClientRect()[side] +\n        getComputedStyle('margin' + Side, elements[i]);\n      if (elVal > maxVal) {\n        maxVal = elVal;\n      }\n    }\n\n    timer = getNow() - timer;\n\n    log('Parsed ' + elementsLength + ' HTML elements');\n    log('Element position calculated in ' + timer + 'ms');\n\n    chkEventThottle(timer);\n\n    return maxVal;\n  }\n\n  function getAllMeasurements(dimention) {\n    return [\n      dimention.bodyOffset(),\n      dimention.bodyScroll(),\n      dimention.documentElementOffset(),\n      dimention.documentElementScroll()\n    ];\n  }\n\n  function getTaggedElements(side, tag) {\n    function noTaggedElementsFound() {\n      warn('No tagged elements (' + tag + ') found on page');\n      return document.querySelectorAll('body *');\n    }\n\n    var elements = document.querySelectorAll('[' + tag + ']');\n\n    if (0 === elements.length) noTaggedElementsFound();\n\n    return getMaxElement(side, elements);\n  }\n\n  function getAllElements() {\n    return document.querySelectorAll('body *');\n  }\n\n  var getHeight = {\n      bodyOffset: function getBodyOffsetHeight() {\n        return (\n          document.body.offsetHeight +\n          getComputedStyle('marginTop') +\n          getComputedStyle('marginBottom')\n        );\n      },\n\n      offset: function() {\n        return getHeight.bodyOffset(); //Backwards compatability\n      },\n\n      bodyScroll: function getBodyScrollHeight() {\n        return document.body.scrollHeight;\n      },\n\n      custom: function getCustomWidth() {\n        return customCalcMethods.height();\n      },\n\n      documentElementOffset: function getDEOffsetHeight() {\n        return document.documentElement.offsetHeight;\n      },\n\n      documentElementScroll: function getDEScrollHeight() {\n        return document.documentElement.scrollHeight;\n      },\n\n      max: function getMaxHeight() {\n        return Math.max.apply(null, getAllMeasurements(getHeight));\n      },\n\n      min: function getMinHeight() {\n        return Math.min.apply(null, getAllMeasurements(getHeight));\n      },\n\n      grow: function growHeight() {\n        return getHeight.max(); //Run max without the forced downsizing\n      },\n\n      lowestElement: function getBestHeight() {\n        return Math.max(\n          getHeight.bodyOffset() || getHeight.documentElementOffset(),\n          getMaxElement('bottom', getAllElements())\n        );\n      },\n\n      taggedElement: function getTaggedElementsHeight() {\n        return getTaggedElements('bottom', 'data-iframe-height');\n      }\n    },\n    getWidth = {\n      bodyScroll: function getBodyScrollWidth() {\n        return document.body.scrollWidth;\n      },\n\n      bodyOffset: function getBodyOffsetWidth() {\n        return document.body.offsetWidth;\n      },\n\n      custom: function getCustomWidth() {\n        return customCalcMethods.width();\n      },\n\n      documentElementScroll: function getDEScrollWidth() {\n        return document.documentElement.scrollWidth;\n      },\n\n      documentElementOffset: function getDEOffsetWidth() {\n        return document.documentElement.offsetWidth;\n      },\n\n      scroll: function getMaxWidth() {\n        return Math.max(\n          getWidth.bodyScroll(),\n          getWidth.documentElementScroll()\n        );\n      },\n\n      max: function getMaxWidth() {\n        return Math.max.apply(null, getAllMeasurements(getWidth));\n      },\n\n      min: function getMinWidth() {\n        return Math.min.apply(null, getAllMeasurements(getWidth));\n      },\n\n      rightMostElement: function rightMostElement() {\n        return getMaxElement('right', getAllElements());\n      },\n\n      taggedElement: function getTaggedElementsWidth() {\n        return getTaggedElements('right', 'data-iframe-width');\n      }\n    };\n\n  function sizeIFrame(\n    triggerEvent,\n    triggerEventDesc,\n    customHeight,\n    customWidth\n  ) {\n    function resizeIFrame() {\n      height = currentHeight;\n      width = currentWidth;\n\n      sendMsg(height, width, triggerEvent);\n    }\n\n    function isSizeChangeDetected() {\n      function checkTolarance(a, b) {\n        var retVal = Math.abs(a - b) <= tolerance;\n        return !retVal;\n      }\n\n      currentHeight =\n        undefined !== customHeight ? customHeight : getHeight[heightCalcMode]();\n      currentWidth =\n        undefined !== customWidth ? customWidth : getWidth[widthCalcMode]();\n\n      return (\n        checkTolarance(height, currentHeight) ||\n        (calculateWidth && checkTolarance(width, currentWidth))\n      );\n    }\n\n    function isForceResizableEvent() {\n      return !(triggerEvent in { init: 1, interval: 1, size: 1 });\n    }\n\n    function isForceResizableCalcMode() {\n      return (\n        heightCalcMode in resetRequiredMethods ||\n        (calculateWidth && widthCalcMode in resetRequiredMethods)\n      );\n    }\n\n    function logIgnored() {\n      log('No change in size detected');\n    }\n\n    function checkDownSizing() {\n      if (isForceResizableEvent() && isForceResizableCalcMode()) {\n        resetIFrame(triggerEventDesc);\n      } else if (!(triggerEvent in { interval: 1 })) {\n        logIgnored();\n      }\n    }\n\n    var currentHeight, currentWidth;\n\n    if (isSizeChangeDetected() || 'init' === triggerEvent) {\n      lockTrigger();\n      resizeIFrame();\n    } else {\n      checkDownSizing();\n    }\n  }\n\n  var sizeIFrameThrottled = throttle(sizeIFrame);\n\n  function sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth) {\n    function recordTrigger() {\n      if (!(triggerEvent in { reset: 1, resetPage: 1, init: 1 })) {\n        log('Trigger event: ' + triggerEventDesc);\n      }\n    }\n\n    function isDoubleFiredEvent() {\n      return triggerLocked && triggerEvent in doubleEventList;\n    }\n\n    if (!isDoubleFiredEvent()) {\n      recordTrigger();\n      if (triggerEvent === 'init') {\n        sizeIFrame(triggerEvent, triggerEventDesc, customHeight, customWidth);\n      } else {\n        sizeIFrameThrottled(\n          triggerEvent,\n          triggerEventDesc,\n          customHeight,\n          customWidth\n        );\n      }\n    } else {\n      log('Trigger event cancelled: ' + triggerEvent);\n    }\n  }\n\n  function lockTrigger() {\n    if (!triggerLocked) {\n      triggerLocked = true;\n      log('Trigger event lock on');\n    }\n    clearTimeout(triggerLockedTimer);\n    triggerLockedTimer = setTimeout(function() {\n      triggerLocked = false;\n      log('Trigger event lock off');\n      log('--');\n    }, eventCancelTimer);\n  }\n\n  function triggerReset(triggerEvent) {\n    height = getHeight[heightCalcMode]();\n    width = getWidth[widthCalcMode]();\n\n    sendMsg(height, width, triggerEvent);\n  }\n\n  function resetIFrame(triggerEventDesc) {\n    var hcm = heightCalcMode;\n    heightCalcMode = heightCalcModeDefault;\n\n    log('Reset trigger event: ' + triggerEventDesc);\n    lockTrigger();\n    triggerReset('reset');\n\n    heightCalcMode = hcm;\n  }\n\n  function sendMsg(height, width, triggerEvent, msg, targetOrigin) {\n    function setTargetOrigin() {\n      if (undefined === targetOrigin) {\n        targetOrigin = targetOriginDefault;\n      } else {\n        log('Message targetOrigin: ' + targetOrigin);\n      }\n    }\n\n    function sendToParent() {\n      var size = height + ':' + width,\n        message =\n          myID +\n          ':' +\n          size +\n          ':' +\n          triggerEvent +\n          (undefined !== msg ? ':' + msg : '');\n\n      log('Sending message to host page (' + message + ')');\n      target.postMessage(msgID + message, targetOrigin);\n    }\n\n    if (true === sendPermit) {\n      setTargetOrigin();\n      sendToParent();\n    }\n  }\n\n  function receiver(event) {\n    var processRequestFromParent = {\n      init: function initFromParent() {\n        initMsg = event.data;\n        target = event.source;\n\n        init();\n        firstRun = false;\n        setTimeout(function() {\n          initLock = false;\n        }, eventCancelTimer);\n      },\n\n      reset: function resetFromParent() {\n        if (!initLock) {\n          log('Page size reset by host page');\n          triggerReset('resetPage');\n        } else {\n          log('Page reset ignored by init');\n        }\n      },\n\n      resize: function resizeFromParent() {\n        sendSize('resizeParent', 'Parent window requested size check');\n      },\n\n      moveToAnchor: function moveToAnchorF() {\n        inPageLinks.findTarget(getData());\n      },\n      inPageLink: function inPageLinkF() {\n        this.moveToAnchor();\n      }, //Backward compatability\n\n      pageInfo: function pageInfoFromParent() {\n        var msgBody = getData();\n        log('PageInfoFromParent called from parent: ' + msgBody);\n        pageInfoCallback(JSON.parse(msgBody));\n        log(' --');\n      },\n\n      message: function messageFromParent() {\n        var msgBody = getData();\n\n        log('MessageCallback called from parent: ' + msgBody);\n        messageCallback(JSON.parse(msgBody));\n        log(' --');\n      }\n    };\n\n    function isMessageForUs() {\n      return msgID === ('' + event.data).substr(0, msgIdLen); //''+ Protects against non-string messages\n    }\n\n    function getMessageType() {\n      return event.data.split(']')[1].split(':')[0];\n    }\n\n    function getData() {\n      return event.data.substr(event.data.indexOf(':') + 1);\n    }\n\n    function isMiddleTier() {\n      return (\n        (!(typeof module !== 'undefined' && module.exports) &&\n          'iFrameResize' in window) ||\n        ('jQuery' in window && 'iFrameResize' in window.jQuery.prototype)\n      );\n    }\n\n    function isInitMsg() {\n      //Test if this message is from a child below us. This is an ugly test, however, updating\n      //the message format would break backwards compatibity.\n      return event.data.split(':')[2] in { true: 1, false: 1 };\n    }\n\n    function callFromParent() {\n      var messageType = getMessageType();\n\n      if (messageType in processRequestFromParent) {\n        processRequestFromParent[messageType]();\n      } else if (!isMiddleTier() && !isInitMsg()) {\n        warn('Unexpected message (' + event.data + ')');\n      }\n    }\n\n    function processMessage() {\n      if (false === firstRun) {\n        callFromParent();\n      } else if (isInitMsg()) {\n        processRequestFromParent.init();\n      } else {\n        log(\n          'Ignored message of type \"' +\n            getMessageType() +\n            '\". Received before initialization.'\n        );\n      }\n    }\n\n    if (isMessageForUs()) {\n      processMessage();\n    }\n  }\n\n  //Normally the parent kicks things off when it detects the iFrame has loaded.\n  //If this script is async-loaded, then tell parent page to retry init.\n  function chkLateLoaded() {\n    if ('loading' !== document.readyState) {\n      window.parent.postMessage('[iFrameResizerChild]Ready', '*');\n    }\n  }\n\n  addEventListener(window, 'message', receiver);\n  addEventListener(window, 'readystatechange', chkLateLoaded);\n  chkLateLoaded();\n\n  \n})();\n"]},"metadata":{},"sourceType":"script"}