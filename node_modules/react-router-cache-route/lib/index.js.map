{"version":3,"file":"index.js","sources":["../src/helpers/base/is.js","../src/helpers/base/try/index.js","../src/helpers/base/globalThis.js","../src/helpers/utils.js","../src/helpers/saveScrollPosition.js","../src/core/manager.js","../src/core/context.js","../src/core/CacheComponent.js","../src/core/Updatable.js","../src/components/CacheRoute.js","../src/components/SwitchFragment.js","../src/components/CacheSwitch.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isUndefined = val => typeof val === 'undefined'\n\nexport const isNull = val => val === null\n\nexport const isFunction = val => typeof val === 'function'\n\nexport const isString = val => typeof val === 'string'\n\nexport const isExist = val => !(isUndefined(val) || isNull(val))\n\nexport const isArray = val => val instanceof Array\n\nexport const isNaN = val => val !== val\n\nexport const isNumber = val => typeof val === 'number' && !isNaN(val)\n// 值类型判断 -------------------------------------------------------------\n","import { isString, isExist, isUndefined, isFunction, isNumber } from '../is'\n\nexport const get = (obj, keys = [], defaultValue) => {\n  try {\n    if (isNumber(keys)) {\n      keys = String(keys)\n    }\n    let result = (isString(keys) ? keys.split('.') : keys).reduce(\n      (res, key) => res[key],\n      obj\n    )\n    return isUndefined(result) ? defaultValue : result\n  } catch (e) {\n    return defaultValue\n  }\n}\n\nexport const run = (obj, keys = [], ...args) => {\n  keys = isString(keys) ? keys.split('.') : keys\n\n  const func = get(obj, keys)\n  const context = get(obj, keys.slice(0, -1))\n\n  return isFunction(func) ? func.call(context, ...args) : func\n}\n\nexport const value = (...values) =>\n  values.reduce(\n    (value, nextValue) => (isUndefined(value) ? run(nextValue) : run(value)),\n    undefined\n  )\n","const getImplementation = () => {\n  if (typeof self !== 'undefined') {\n    return self\n  }\n  if (typeof window !== 'undefined') {\n    return window\n  }\n  if (typeof global !== 'undefined') {\n    return global\n  }\n\n  throw new Error('unable to locate global object')\n}\n\nconst implementation = getImplementation()\n\nconst getGlobal = () => {\n  if (\n    typeof global !== 'object' ||\n    !global ||\n    global.Math !== Math ||\n    global.Array !== Array\n  ) {\n    return implementation\n  }\n  return global\n}\n\nconst globalThis = getGlobal()\n\nexport default globalThis\n","import { isArray } from './base/is'\n\nexport const nextTick = func => Promise.resolve().then(func)\n\nexport const flatten = array =>\n  array.reduce(\n    (res, item) => [...res, ...(isArray(item) ? flatten(item) : [item])],\n    []\n  )\n\n/**\n * [钳子] 用来将数字限制在给定范围内\n * @param {Number} value 被限制值\n * @param {Number} min 最小值\n * @param {Number} max 最大值\n */\nexport const clamp = (value, min, max = Number.MAX_VALUE) => {\n  if (value < min) {\n    return min\n  }\n\n  if (value > max) {\n    return max\n  }\n\n  return value\n}\n\nexport const ObjectValues = (object) => {\n  const res = []\n  for (let key in object) {\n    res.push(object[key])\n  }\n  return res\n}\n","import root from './base/globalThis'\nimport { get, run, value } from './base/try'\nimport { isArray, isFunction, isExist } from './base/is'\nimport { flatten } from './utils'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.getElementById'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [\n    ...new Set([\n      ...flatten((!isArray(from) ? [from] : from).map(getScrollableNodes)),\n      ...[screenScrollingElement, body].filter(isScrollableNode)\n    ])\n  ]\n\n  const saver = nodes.map(node => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop\n    }\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import CacheComponent from './CacheComponent'\nimport { get, run } from '../helpers'\n\nconst __components = {}\n\nconst getCachedComponentEntries = () =>\n  Object.entries(__components).filter(\n    ([, cache]) =>\n      cache instanceof CacheComponent\n        ? cache.state.cached\n        : Object.values(cache).some(cache => cache.state.cached)\n  )\n\nexport const getCache = () => ({ ...__components })\n\nexport const register = (key, component) => {\n  __components[key] = component\n}\n\nexport const remove = key => {\n  delete __components[key]\n}\n\nconst dropComponent = component => run(component, 'reset')\n\nexport const dropByCacheKey = key => {\n  const cache = get(__components, [key])\n\n  if (!cache) {\n    return\n  }\n\n  if (cache instanceof CacheComponent) {\n    dropComponent(cache)\n  } else {\n    Object.values(cache).forEach(dropComponent)\n  }\n}\n\nconst refreshComponent = component => run(component, 'refresh');\n\nexport const refreshByCacheKey = key => {\n  const cache = get(__components, [key]);\n\n  if (!cache) {\n    return;\n  }\n\n  if (cache instanceof CacheComponent) {\n    refreshComponent(cache);\n  } else {\n    Object.values(cache).forEach(refreshComponent);\n  }\n};\n\nexport const clearCache = () => {\n  getCachedComponentEntries().forEach(([key]) => dropByCacheKey(key))\n}\n\nexport const getCachingKeys = () =>\n  getCachedComponentEntries().map(([key]) => key)\n\nexport const getCachingComponents = () =>\n  getCachedComponentEntries().reduce(\n    (res, [key, cache]) => ({\n      ...res,\n      ...(cache instanceof CacheComponent\n        ? { [key]: cache }\n        : Object.entries(cache).reduce(\n            (res, [pathname, cache]) => ({\n              ...res,\n              [`${key}.${pathname}`]: cache\n            }),\n            {}\n          ))\n    }),\n    {}\n  )\n","import { useEffect, useContext } from 'react'\nimport createContext from 'mini-create-react-context'\n\nimport { isArray, isFunction, run } from '../helpers'\n\nconst context = createContext()\n\nexport default context\nexport const { Provider, Consumer } = context\n\nfunction useCacheRoute(lifecycleName, effect, deps = []) {\n  if (!isFunction(useContext)) {\n    return\n  }\n\n  const cacheLifecycles = useContext(context)\n  useEffect(() => {\n    const off = run(cacheLifecycles, 'on', lifecycleName, effect)\n\n    return () => run(off)\n  }, deps)\n}\nexport const useDidCache = useCacheRoute.bind(null, 'didCache')\nexport const useDidRecover = useCacheRoute.bind(null, 'didRecover')\n","import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\nimport {\r\n  run,\r\n  get,\r\n  value,\r\n  isExist,\r\n  isFunction,\r\n  saveScrollPosition,\r\n  ObjectValues\r\n} from '../helpers'\r\nimport * as manager from './manager'\r\nimport { Provider as CacheRouteProvider } from './context'\r\n\r\nconst isUsingNewLifecycle = isExist(React.forwardRef)\r\n\r\nexport const COMPUTED_UNMATCH_KEY = '__isComputedUnmatch'\r\nexport const isMatch = match =>\r\n  isExist(match) && get(match, COMPUTED_UNMATCH_KEY) !== true\r\n\r\nconst getDerivedStateFromProps = (nextProps, prevState) => {\r\n  let { match: nextPropsMatch, when = 'forward' } = nextProps\r\n\r\n  /**\r\n   * Note:\r\n   * Turn computedMatch from CacheSwitch to a real null value\r\n   *\r\n   * 将 CacheSwitch 计算得到的 computedMatch 值转换为真正的 null\r\n   */\r\n  if (!isMatch(nextPropsMatch)) {\r\n    nextPropsMatch = null\r\n  }\r\n\r\n  if (!prevState.cached && nextPropsMatch) {\r\n    return {\r\n      cached: true,\r\n      matched: true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Determines whether it needs to cancel the cache based on the next unmatched props action\r\n   *\r\n   * 根据下个未匹配状态动作决定是否需要取消缓存\r\n   */\r\n  if (prevState.matched && !nextPropsMatch) {\r\n    const nextAction = get(nextProps, 'history.action')\r\n\r\n    let __cancel__cache = false\r\n\r\n    if (isFunction(when)) {\r\n      __cancel__cache = !when(nextProps)\r\n    } else {\r\n      switch (when) {\r\n        case 'always':\r\n          break\r\n        case 'back':\r\n          if (['PUSH', 'REPLACE'].includes(nextAction)) {\r\n            __cancel__cache = true\r\n          }\r\n\r\n          break\r\n        case 'forward':\r\n        default:\r\n          if (nextAction === 'POP') {\r\n            __cancel__cache = true\r\n          }\r\n      }\r\n    }\r\n\r\n    if (__cancel__cache) {\r\n      return {\r\n        cached: false,\r\n        matched: false\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    matched: !!nextPropsMatch\r\n  }\r\n}\r\n\r\nexport default class CacheComponent extends Component {\r\n  static __name = 'CacheComponent'\r\n\r\n  static propsTypes = {\r\n    history: PropTypes.object.isRequired,\r\n    match: PropTypes.object.isRequired,\r\n    children: PropTypes.func.isRequired,\r\n    className: PropTypes.string,\r\n    when: PropTypes.oneOfType([\r\n      PropTypes.func,\r\n      PropTypes.oneOf(['forward', 'back', 'always'])\r\n    ]),\r\n    behavior: PropTypes.func,\r\n    unmount: PropTypes.bool,\r\n    saveScrollPosition: PropTypes.bool\r\n  }\r\n\r\n  static defaultProps = {\r\n    when: 'forward',\r\n    unmount: false,\r\n    saveScrollPosition: false,\r\n    behavior: cached =>\r\n      cached\r\n        ? {\r\n            style: {\r\n              display: 'none'\r\n            }\r\n          }\r\n        : undefined\r\n  }\r\n\r\n  constructor(props, ...args) {\r\n    super(props, ...args)\r\n\r\n    this.__cacheCreateTime = Date.now()\r\n    this.__cacheUpdateTime = this.__cacheCreateTime\r\n    if (props.cacheKey) {\r\n      const cacheKey = run(props.cacheKey, undefined, props)\r\n      if (props.multiple) {\r\n        const { pathname } = props\r\n        manager.register(cacheKey, {\r\n          ...manager.getCache()[cacheKey],\r\n          [pathname]: this\r\n        })\r\n      } else {\r\n        manager.register(cacheKey, this)\r\n      }\r\n    }\r\n\r\n    if (typeof document !== 'undefined') {\r\n      const cacheKey = run(props.cacheKey, undefined, props)\r\n      this.__placeholderNode = document.createComment(\r\n        ` Route cached ${cacheKey ? `with cacheKey: \"${cacheKey}\" ` : ''}`\r\n      )\r\n    }\r\n\r\n    this.state = getDerivedStateFromProps(props, {\r\n      cached: false,\r\n      matched: false,\r\n      key: Math.random()\r\n    })\r\n  }\r\n\r\n  cacheLifecycles = {\r\n    __listener: {},\r\n    __didCacheListener: {},\r\n    __didRecoverListener: {},\r\n    on: (eventName, func) => {\r\n      const id = Math.random()\r\n      const listenerKey = `__${eventName}Listener`\r\n      this.cacheLifecycles[listenerKey][id] = func\r\n\r\n      return () => {\r\n        delete this.cacheLifecycles[listenerKey][id]\r\n      }\r\n    },\r\n    didCache: listener => {\r\n      this.cacheLifecycles.__listener['didCache'] = listener\r\n    },\r\n    didRecover: listener => {\r\n      this.cacheLifecycles.__listener['didRecover'] = listener\r\n    }\r\n  }\r\n\r\n  /**\r\n   * New lifecycle for replacing the `componentWillReceiveProps` in React 16.3 +\r\n   * React 16.3 + 版本中替代 componentWillReceiveProps 的新生命周期\r\n   */\r\n  static getDerivedStateFromProps = isUsingNewLifecycle\r\n    ? getDerivedStateFromProps\r\n    : undefined\r\n\r\n  /**\r\n   * Compatible React 16.3 -\r\n   * 兼容 React 16.3 - 版本\r\n   */\r\n  componentWillReceiveProps = !isUsingNewLifecycle\r\n    ? nextProps => {\r\n        const nextState = getDerivedStateFromProps(nextProps, this.state)\r\n\r\n        this.setState(nextState)\r\n      }\r\n    : undefined\r\n\r\n  __parentNode\r\n  __placeholderNode\r\n  __revertScrollPos\r\n  injectDOM = () => {\r\n    try {\r\n      run(\r\n        this.__parentNode,\r\n        'insertBefore',\r\n        this.wrapper,\r\n        this.__placeholderNode\r\n      )\r\n      run(this.__parentNode, 'removeChild', this.__placeholderNode)\r\n    } catch (err) {\r\n      // nothing\r\n    }\r\n  }\r\n\r\n  ejectDOM = () => {\r\n    try {\r\n      const parentNode = get(this.wrapper, 'parentNode')\r\n      this.__parentNode = parentNode\r\n\r\n      run(\r\n        this.__parentNode,\r\n        'insertBefore',\r\n        this.__placeholderNode,\r\n        this.wrapper\r\n      )\r\n      run(this.__parentNode, 'removeChild', this.wrapper)\r\n    } catch (err) {\r\n      // nothing\r\n    }\r\n  }\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (!prevState.cached || !this.state.cached) {\r\n      return\r\n    }\r\n\r\n    if (prevState.matched === true && this.state.matched === false) {\r\n      if (this.props.unmount) {\r\n        this.ejectDOM()\r\n      }\r\n      this.__cacheUpdateTime = Date.now()\r\n      ObjectValues(this.cacheLifecycles.__didCacheListener).forEach(func => {\r\n        run(func)\r\n      })\r\n      return run(this, 'cacheLifecycles.__listener.didCache')\r\n    }\r\n\r\n    if (prevState.matched === false && this.state.matched === true) {\r\n      if (this.props.saveScrollPosition) {\r\n        run(this.__revertScrollPos)\r\n      }\r\n      this.__cacheUpdateTime = Date.now()\r\n      ObjectValues(this.cacheLifecycles.__didRecoverListener).forEach(func => {\r\n        run(func)\r\n      })\r\n      return run(this, 'cacheLifecycles.__listener.didRecover')\r\n    }\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    const willRecover =\r\n      this.state.matched === false && nextState.matched === true\r\n    const willDrop = this.state.cached === true && nextState.cached === false\r\n    const shouldUpdate =\r\n      this.state.matched ||\r\n      nextState.matched ||\r\n      this.state.cached !== nextState.cached\r\n\r\n    if (shouldUpdate) {\r\n      if ((this.props.unmount && willDrop) || willRecover) {\r\n        this.injectDOM()\r\n      }\r\n\r\n      if (!(willDrop || willRecover) && this.props.saveScrollPosition) {\r\n        this.__revertScrollPos = saveScrollPosition(\r\n          this.props.unmount ? this.wrapper : undefined\r\n        )\r\n      }\r\n    }\r\n\r\n    return shouldUpdate\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const { unmount, pathname, multiple } = this.props\r\n    const cacheKey = run(this.props, 'cacheKey', this.props)\r\n\r\n    if (multiple) {\r\n      const cache = { ...manager.getCache()[cacheKey] }\r\n\r\n      delete cache[pathname]\r\n\r\n      if (Object.keys(cache).length === 0) {\r\n        manager.remove(cacheKey)\r\n      } else {\r\n        manager.register(cacheKey, cache)\r\n      }\r\n    } else {\r\n      manager.remove(cacheKey)\r\n    }\r\n\r\n    if (unmount) {\r\n      this.injectDOM()\r\n    }\r\n  }\r\n\r\n  reset = () => {\r\n    delete this.__revertScrollPos\r\n\r\n    this.setState({\r\n      cached: false\r\n    })\r\n  }\r\n\r\n  refresh = () => {\r\n    delete this.__revertScrollPos;\r\n\r\n    this.setState({\r\n      key: Math.random()\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { matched, cached, key } = this.state\r\n    const { className: propsClassName = '', behavior, children } = this.props\r\n    const { className: behaviorClassName = '', ...behaviorProps } = value(\r\n      run(behavior, undefined, !matched),\r\n      {}\r\n    )\r\n    const className = run(`${propsClassName} ${behaviorClassName}`, 'trim')\r\n    const hasClassName = className !== ''\r\n\r\n    return cached ? (\r\n      <div\r\n        key={key}\r\n        className={hasClassName ? className : undefined}\r\n        {...behaviorProps}\r\n        ref={wrapper => {\r\n          this.wrapper = wrapper\r\n        }}\r\n      >\r\n        <CacheRouteProvider value={this.cacheLifecycles}>\r\n          {run(children, undefined, this.cacheLifecycles)}\r\n        </CacheRouteProvider>\r\n      </div>\r\n    ) : null\r\n  }\r\n}\r\n","import { Component } from 'react'\nimport PropTypes from 'prop-types'\n\nimport { run, get } from '../helpers'\n\nexport default class Updatable extends Component {\n  static propsTypes = {\n    when: PropTypes.bool.isRequired\n  }\n\n  render = () => run(this.props, 'children')\n  shouldComponentUpdate = ({ when }) => when\n}\n","import React, { Component, Fragment } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { Route } from 'react-router-dom'\r\n\r\nimport CacheComponent, { isMatch } from '../core/CacheComponent'\r\nimport Updatable from '../core/Updatable'\r\nimport { run, isExist, isNumber, clamp } from '../helpers'\r\n\r\nconst isEmptyChildren = children => React.Children.count(children) === 0\r\nconst isFragmentable = isExist(Fragment)\r\n\r\nexport default class CacheRoute extends Component {\r\n  static __name = 'CacheRoute'\r\n\r\n  static propTypes = {\r\n    component: PropTypes.elementType || PropTypes.any,\r\n    render: PropTypes.func,\r\n    children: PropTypes.oneOfType([PropTypes.func, PropTypes.node]),\r\n    computedMatchForCacheRoute: PropTypes.object,\r\n    multiple: PropTypes.oneOfType([PropTypes.bool, PropTypes.number])\r\n  }\r\n\r\n  static defaultProps = {\r\n    multiple: false\r\n  }\r\n\r\n  cache = {}\r\n\r\n  render() {\r\n    let {\r\n      children,\r\n      render,\r\n      component,\r\n      className,\r\n      when,\r\n      behavior,\r\n      cacheKey,\r\n      unmount,\r\n      saveScrollPosition,\r\n      computedMatchForCacheRoute,\r\n      multiple,\r\n      ...restProps\r\n    } = this.props\r\n\r\n    /**\r\n     * Note:\r\n     * If children prop is a React Element, define the corresponding wrapper component for supporting multiple children\r\n     *\r\n     * 说明：如果 children 属性是 React Element 则定义对应的包裹组件以支持多个子组件\r\n     */\r\n    if (React.isValidElement(children) || !isEmptyChildren(children)) {\r\n      render = () => children\r\n    }\r\n\r\n    if (computedMatchForCacheRoute) {\r\n      restProps.computedMatch = computedMatchForCacheRoute\r\n    }\r\n\r\n    if (multiple && !isFragmentable) {\r\n      multiple = false\r\n    }\r\n\r\n    if (isNumber(multiple)) {\r\n      multiple = clamp(multiple, 1)\r\n    }\r\n\r\n    return (\r\n      /**\r\n       * Only children prop of Route can help to control rendering behavior\r\n       * 只有 Router 的 children 属性有助于主动控制渲染行为\r\n       */\r\n      <Route {...restProps}>\r\n        {props => {\r\n          const { match, computedMatch, location } = props\r\n          const isMatchCurrentRoute = isMatch(props.match)\r\n          const { pathname: currentPathname, search: currentSearch } = location\r\n          const maxMultipleCount = isNumber(multiple) ? multiple : Infinity\r\n          const configProps = {\r\n            when,\r\n            className,\r\n            behavior,\r\n            cacheKey,\r\n            unmount,\r\n            saveScrollPosition\r\n          }\r\n\r\n          const renderSingle = props => (\r\n            <CacheComponent {...props}>\r\n              {cacheLifecycles => (\r\n                <Updatable when={isMatch(props.match)}>\r\n                  {() => {\r\n                    Object.assign(props, { cacheLifecycles })\r\n\r\n                    if (component) {\r\n                      return React.createElement(component, props)\r\n                    }\r\n\r\n                    return run(render || children, undefined, props)\r\n                  }}\r\n                </Updatable>\r\n              )}\r\n            </CacheComponent>\r\n          )\r\n\r\n          if (multiple && isMatchCurrentRoute) {\r\n            this.cache[currentPathname + currentSearch] = {\r\n              updateTime: Date.now(),\r\n              pathname: currentPathname,\r\n              search: currentSearch,\r\n              render: renderSingle\r\n            }\r\n\r\n            Object.entries(this.cache)\r\n              .sort(([, prev], [, next]) => next.updateTime - prev.updateTime)\r\n              .forEach(([pathname], idx) => {\r\n                if (idx >= maxMultipleCount) {\r\n                  delete this.cache[pathname]\r\n                }\r\n              })\r\n          }\r\n\r\n          return multiple ? (\r\n            <Fragment>\r\n              {Object.entries(this.cache).map(([multipleCacheKey, { render, pathname }]) => {\r\n                const recomputedMatch =\r\n                  multipleCacheKey === currentPathname + currentSearch ? match || computedMatch : null\r\n\r\n                return (\r\n                  <Fragment key={multipleCacheKey}>\r\n                    {render({\r\n                      ...props,\r\n                      ...configProps,\r\n                      pathname,\r\n                      cacheKey,\r\n                      multiple: true,\r\n                      key: pathname,\r\n                      match: recomputedMatch\r\n                    })}\r\n                  </Fragment>\r\n                )\r\n              })}\r\n            </Fragment>\r\n          ) : (\r\n            renderSingle({\r\n              ...props,\r\n              ...configProps,\r\n              pathname: currentPathname,\r\n              multiple: false\r\n            })\r\n          )\r\n        }}\r\n      </Route>\r\n    )\r\n  }\r\n}\r\n","import React, { PropTypes, Fragment } from 'react'\n\nimport { isExist } from '../helpers'\n\nfunction getFragment() {\n  if (isExist(Fragment)) {\n    return ({ children }) => <Fragment>{children}</Fragment>\n  }\n\n  if (isExist(PropTypes)) {\n    return ({ children }) => <div>{children}</div>\n  }\n\n  return ({ children }) => children\n}\n\nconst SwitchFragment = getFragment()\nSwitchFragment.displayName = 'SwitchFragment'\n\nexport default SwitchFragment\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Switch,\n  matchPath,\n  withRouter,\n  useHistory,\n  __RouterContext\n} from 'react-router-dom'\n\nimport { COMPUTED_UNMATCH_KEY, isMatch } from '../core/CacheComponent'\nimport Updatable from '../core/Updatable'\nimport SwitchFragment from './SwitchFragment'\nimport { get, isNull, isExist } from '../helpers'\n\nconst isUsingNewContext = isExist(__RouterContext) || isExist(useHistory)\n\nclass CacheSwitch extends Switch {\n  getContext = () => {\n    if (isUsingNewContext) {\n      const { location, match } = this.props\n\n      return { location, match }\n    } else {\n      const { route } = this.context.router\n      const location = this.props.location || route.location\n\n      return {\n        location,\n        match: route.match\n      }\n    }\n  }\n\n  render() {\n    const { children, which } = this.props\n    const { location, match: contextMatch } = this.getContext()\n\n    let __matchedAlready = false\n\n    return (\n      <Updatable when={isMatch(contextMatch)}>\n        {() => (\n          <SwitchFragment>\n            {React.Children.map(children, element => {\n              if (!React.isValidElement(element)) {\n                return null\n              }\n\n              const path = element.props.path || element.props.from\n              const match = __matchedAlready\n                ? null\n                : path\n                  ? matchPath(\n                      location.pathname,\n                      {\n                        ...element.props,\n                        path\n                      },\n                      contextMatch\n                    )\n                  : contextMatch\n\n              let child\n\n              if (which(element)) {\n                child = React.cloneElement(element, {\n                  location,\n                  computedMatch: match,\n                  /**\n                   * https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Route.js#L57\n                   *\n                   * Note:\n                   * Route would use computedMatch as its next match state ONLY when computedMatch is a true value\n                   * So here we have to do some trick to let the unmatch result pass Route's computedMatch check\n                   *\n                   * 注意：只有当 computedMatch 为真值时，Route 才会使用 computedMatch 作为其下一个匹配状态\n                   * 所以这里我们必须做一些手脚，让 unmatch 结果通过 Route 的 computedMatch 检查\n                   */\n                  ...(isNull(match)\n                    ? {\n                        computedMatchForCacheRoute: {\n                          [COMPUTED_UNMATCH_KEY]: true\n                        }\n                      }\n                    : null)\n                })\n              } else {\n                child =\n                  match && !__matchedAlready\n                    ? React.cloneElement(element, {\n                        location,\n                        computedMatch: match\n                      })\n                    : null\n              }\n\n              if (!__matchedAlready) {\n                __matchedAlready = !!match\n              }\n\n              return child\n            })}\n          </SwitchFragment>\n        )}\n      </Updatable>\n    )\n  }\n}\n\nif (isUsingNewContext) {\n  CacheSwitch.propTypes = {\n    children: PropTypes.node,\n    location: PropTypes.object.isRequired,\n    match: PropTypes.object.isRequired,\n    which: PropTypes.func\n  }\n\n  CacheSwitch = withRouter(CacheSwitch)\n} else {\n  CacheSwitch.contextTypes = {\n    router: PropTypes.shape({\n      route: PropTypes.object.isRequired\n    }).isRequired\n  }\n\n  CacheSwitch.propTypes = {\n    children: PropTypes.node,\n    location: PropTypes.object,\n    which: PropTypes.func\n  }\n}\n\nCacheSwitch.defaultProps = {\n  which: element => get(element, 'type.__name') === 'CacheRoute'\n}\n\nexport default CacheSwitch\n"],"names":["isUndefined","val","isNull","isFunction","isString","isExist","isArray","Array","isNaN","isNumber","get","obj","keys","defaultValue","String","result","split","reduce","res","key","e","run","args","func","context","slice","call","value","values","nextValue","undefined","getImplementation","self","window","global","Error","implementation","getGlobal","Math","globalThis","flatten","array","item","clamp","min","max","Number","MAX_VALUE","ObjectValues","object","push","body","root","screenScrollingElement","isScrollableNode","node","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","filter","saveScrollPosition","nodes","Set","map","saver","scrollLeft","scrollTop","revert","forEach","x","y","__components","getCachedComponentEntries","Object","entries","cache","CacheComponent","state","cached","some","getCache","register","component","remove","dropComponent","dropByCacheKey","refreshComponent","refreshByCacheKey","clearCache","getCachingKeys","getCachingComponents","pathname","createContext","Provider","Consumer","useCacheRoute","lifecycleName","effect","deps","useContext","cacheLifecycles","off","useDidCache","bind","useDidRecover","isUsingNewLifecycle","React","forwardRef","COMPUTED_UNMATCH_KEY","isMatch","match","getDerivedStateFromProps","nextProps","prevState","nextPropsMatch","when","matched","nextAction","__cancel__cache","includes","props","eventName","id","random","listenerKey","__listener","listener","componentWillReceiveProps","nextState","setState","injectDOM","__parentNode","wrapper","__placeholderNode","err","ejectDOM","parentNode","reset","__revertScrollPos","refresh","__cacheCreateTime","Date","now","__cacheUpdateTime","cacheKey","multiple","manager","document","createComment","prevProps","unmount","__didCacheListener","__didRecoverListener","willRecover","willDrop","shouldUpdate","length","className","propsClassName","behavior","children","behaviorClassName","behaviorProps","hasClassName","Component","__name","propsTypes","PropTypes","isRequired","string","oneOfType","oneOf","bool","defaultProps","Updatable","render","shouldComponentUpdate","isEmptyChildren","Children","count","isFragmentable","Fragment","CacheRoute","computedMatchForCacheRoute","restProps","isValidElement","computedMatch","location","isMatchCurrentRoute","currentPathname","currentSearch","search","maxMultipleCount","Infinity","configProps","renderSingle","assign","createElement","sort","prev","next","updateTime","idx","multipleCacheKey","recomputedMatch","propTypes","elementType","any","number","getFragment","SwitchFragment","displayName","isUsingNewContext","__RouterContext","useHistory","CacheSwitch","getContext","route","router","which","contextMatch","__matchedAlready","element","path","matchPath","child","cloneElement","Switch","withRouter","contextTypes","shape"],"mappings":"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"}